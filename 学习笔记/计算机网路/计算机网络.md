## 计算机网络

#### 通信模型

信源－》发送设备－》信道－》接受设备－》信宿

　　　　　　　　　　　｜

​                                      噪声源

## 交换网络



## internet网络

最大的互联网络

ｉｓｐ 网络

为网络应用提供通信服务的通信技术设施

为网络应用提供应用编程接口

## 计算接网络结构：

1. 网络边缘，

   > 主机，端系统
   >
   > 运行网络应用程序
   >
   > 客户/服务器应用模型
   >
   > 对等模型（p2p）

2. 接入应用，物质链接

   > 接入网络，
   >
   > 机构接入网络
   >
   > 移动接入网络
   >
   > dsl数字用户线路，
   >
   > hfc混合光钎同轴电缆
   >
   > 

3. 网络核心（核心网络）

   功能：路由，转发

   路由：确定分组从源到目的传输路径

   转发：将分组从路由器的输入端口交换至正确的输出端口

   #### 数据交换

   一级ｉｓｐ 向下 公司ｉｓｐ 等等

   多路复用：链路网络资源划分

   典型的多路复用方法：

   频分多路复用　电视信号

   时分多路复用　将时间分为服用帧，每个帧分成若干个时序，每个用户这在对应的时序里发送

   波分多路复用　根据每个光的波长进行分离　

   码分多路复用　广泛应用（如蜂窝网，卫星通信），每个用户分到一个马片序列

   　　　　编码信号＝原始数据×码片序列，＋１　－１　　0

   　　　　码片序列必须正交

   

   

   报文交换：发送整体信息，例子：电报

   分组交换：将报文分为一系列相对较小的数据包

   　　　　　拆分，重组，在报文头部加上一些数据，和需要拆分时间

   　　　　　统计多路复用

   两种的方式：都是存储　交换　　　　　



分组交换网络实用于突发数据传输网络

　　　　可能产生拥塞：分组延迟和丢失

　　　　协议





### 计算机性能：

速率　　　    比特

带宽　　       通常是指数字信道所能传达的最高数位

时延/延迟      分类：节点处理延迟　　　排队延迟　　传输延迟（发送总时间）　　　　传播延迟（信号传播初度）

实验带宽积＝传播延迟×带宽

　　　　　链路的试验带宽积又称尾以比特为单位的链路带宽

丢包：　队列缓存容量有限，分组达到满队列将被丢包，

　　　　丢包分组可能由前节点或源重发（也可能不重发）

　　　　丢包率：丢包数/已发分组总数

吞吐量/率：表示发送端与接受端之间传送数据速率

　　　　　即时吞吐率：给定时刻的速率

　　　　　平均吞吐率：一段时间的平均速率

#### 计算接网络的体系结构

　　　　　Ａ：分层结构　　功能层面

　　　　　　　结构清晰

　　　　　　　模块化分层易于系统更新，维护

　　　　　　　有利于标准化

　　　　　　　缺点：效率低

　　　　　基本概念：

　　　　　　　实体：表示任何可发送或接受信息的硬件或软件

　　　　　　　协议：是控制两个对等实体进行通信的规则的集合，协议是“水平的”

　　　　　　　任意层实体需要使用下层服务，遵循本层协议，实现本层功能，向上层提供服务，服务是“垂直的”

　　　　　　　下层协议的实现对上层的服务用户是透明的

　　　　　　　同系统的相邻层实体间通过借口进行交互，通过服务访问点ＳAP，交换愿语，指定请求的特定服务

#### osi参考模型

　　　七个层次

　　　主机Ａ　１－７

　　　物理层－》数据链路层－》网络层－》传输层－》会话层－》表示层－》应用层

　　　　　｜　　　　｜　　　　　｜　　　　｜　　　　｜　　　　｜　　　　｜　

　　　中间系统

　　　物理层－》数据链路层－》网络层　　　　协议

　　　　　｜　　　　｜　　　　　　｜　　　　｜　　　　｜　　　　｜　　　｜

　　　主机Ｂ

　　　物理层－》数据链路层－》网络层－》传输层－》会话层－》表示层－》应用层

　　　

　　　协议封装

　　　　加控制信息

　　　　　　地址

　　　　　　差错检测编码

　　　　　　协议控制　



　　　　物理层：

　　　　　接口特性：机械特性，电气特性，功能特性，规则特性

　　　　比特编码：

　　　　数据率：

　　　　比特同步：时钟同步

　　　　传输模式：单工，半双工，　全双工



　　　　数据链路层功能：　

　　　　节点－节点（数据传输）　

　　　　组帧：

　　　　物理地址：

　　　　　　在帧头中增加发送端和/或接收端的物理地址标识数据的发送端和/或接收端

　　　　流量控制

　　　　差错控制

　　　　访问（接入）控制



　　　　网络层功能：

　　　　负责源主机到目的主机数据分组交付

　　　　逻辑寻址：

　　　　路由：

　　　　分组转发



　　　　传输层功能：

　　　　分段重组

　　　　ＳＡＰ寻址

　　　　链接控制

　　　　流量控制

　　　　差错控制



　　　　会话层

　　　　对话控制：建立，维护

　　　　同步：

　　　　

　　　　表示层：

　　　　数据标示转化

　　　　加密/解密

　　　    压缩/解压缩



​                应用层

　　　　使用网络服务

　　　　文件传输，电子邮件，　ｗｅｂ



　#### ＴＣＰ参考模型

　　　　应用层

　　　　运输层

　　　　网际层

　　　　网络接口层



现在通用的

　　　应用层　　应用，支持各种网络应用

　　　传输层　　进程－进程的数据传输

　　　网路层　　路由转发，源主机到目的主机的数据分组路由与转发

　　　数据链路层　　相邻网络元素（主机，交换机，路由器）的数据传输

　　　物理层　　　比特传输



计算机网络的发展历史

１９６１－１９７２　早起分组交换原理的提出与应用

１９６１　排队论证实分组交换的有效性

１９６４　分组交换用于军事网络

１９６７　ａｐｐａ

１９６９：第一个ａｒｐａｎｅｔ节点运行

１９７２：ａｒｐａｎｅｔ公开演示

　　　　　第一个主机－主机协议ｎｃｐ

　　　　　第一个ｅ-ｍａｉｌ程序

　　　　　　ａｒｐａｎｅｔ拥有１５个节点



１９７２－１９８０：网络互联，大型新型，私有网络涌现

１９７０：在夏威夷构建了ａｌｏｈａｎｅｔ卫星网络

１９７４　ｃｒｅｆ　与ｋａｈｎ　提出网络互联体系结构

１９７６：ｘｅｒｏｘ　设计了以太网

７０‘ｓ 后期

１９７５：ａｐｒａｎｅｔ移交给美国国防不通信局管理

１９７９：ａｐｒａｎｅｔ拥有２００个节点



１９８０－１９９０：新型网络协议与网络的激增

１９８３：部署ｔｃｐ/ｉｐ

１９８２：定义了ｓｍｔｐ电子邮件协议

１９８３：定义了ｄｎｓ

１９８５：定义了ｆｔｐ协议

１９８８：ｔｃｐ拥塞控制

新型国家级网络　法国



１９８６；ｎｆｓ初步形成



１９９０－２０００：商业化　ｗｅｂ　新应用

１９９０’ｓ早期：ａｐｒｎｅｔ退役

１９９１：ｎｓｆ　解除限制

１９９２：因特网协会

１９９０‘ｓ后期　ｗｅｂ应用



２００５－今

　　智能手机－平板电脑

宽带接入的快速部署

无处不在的高速无线接入快速增长

出现在线社交网络

服务提供商　　　有自己专有的网络



电子商务，大学，企业等开始在“云”中运行自己的服务　（如　ａｍａｚｏｎ）







### 应用层

#### 网络应用体系机构

 客户机/服务器　　（ｗｅｂ）

纯p2p结构　优点：高度可伸缩，　缺点：复杂度高

混合结构　有文件的服务者，利用者。



#### 网络应用的基础：进程间通信

进程，同一主机上运行的进程之间如何通信

不同主机上运行的进程间如何通信

进程之间的交流：套接字：ｓｏｃｋｅｔ

进程间通信利用ｓｏｃｋｅｔ发送/接受消息实现

类似于寄信

传输基础设施向进程提供ａｐｉ



寻址：不同主机上的进程间通信，那么每个进程必须拥有标识符

端口号：每个进程有一个端口号

ｉｐ地址加端口号

应用层协议：网络应用需遵循应用协议

公开协议：由ｒｆｃ定义

　　　　　允许互操作

　　　　　ｈｔｔｐ，ｓｍｔｐ

私有协议

大胆的设计新协议



协议的内容

消息的类型

消息的语法格式

字段的语义

规则



网络应用的需求与传输层服务

数据丢失/可靠性

时间/延迟

带宽



ｉｎｔｅｒｎｅｔ提供的传输服务

　Ｔcp 服务

面向链接;

可靠的传输

流量控制

拥塞控制

不提供时间/延迟保障

不提供最小带宽保障

ＵＤＰ服务

无连接

不可靠的数据传输

不提供：等等能等等



#### web应用

　网页

　网页相互链接

网页包含多个对象

　对象

基本ｈｔｍｌ文件

对象的寻址

ｈｔｔｐ协议超文本传输协议

ｃ/s结构　客户－请求，接受，展示

无状态协议

非持久性链接，

发起请求－连接请求－确定文件位置－发送－关闭－重复

ｒｔｔ　从客户端发送一个很小的数据包到服务器

每个对象需要２个ｒｔｔ　操作系统为每个ｔｃｐ链接开销资源

建立ｔｃｐ是有代价的



持久性链接

发送响应后，服务器保持ｔｃｐ链接

后续的ｈｔｔｐ消息可以通过这个链接发送

等等



ｈｔｔｐ消息格式

请求消息：方法，ｕｒｌ　名字，东西

ａｓｃｉｉ：　人直接可读



响应消息

上次的修改时间，

状态码　　４０４



　

cookie技术

有存储功能

增加一个可扩展标记号

功能：身份认证，购物车，推荐，ｗｅｂ　ｅ-ｍａｉｌ

问题：隐私问题



ｗｅｂ缓存/代理服务器技术

功能：不访问服务器的前提下满足客户端的ｈｔｔｐ请求

优点：缩短客户请求时间，减少机构/组织的流量，在大范围内实现有效的内容分发

时间：建立一个代理服务器，里客户端近的

问题：版本是最新的吗？

条件性ｇｅｔ方法

目标：如果缓存有最新的版本，则不需要发送请求对象

缓存：在ｈｔｔｐ请求消息中声明所持有版本的日期

服务器：如果缓存的版本是最新的，则响应消息中不包含对象



#### Email应用

邮件服务器

邮箱：存储发给该用户

消息队列：存储等待发送的ｅmail

ｓｍｔｐ　邮件服务器之间的消息传递所使用的协议

使用ｔｃｐ协议　



命令的响应模式

持久性链接

要求小时必须是７尾ａｓｃｉｉ码构成

ｓｍｔｐ服务器



ｅｍａｉｌ消息的格式　传输/交换协议

ｒｆｃ８２２：文本消息格式标准

头部行：　

消息体：



多媒体扩展：

ｍｉｍｅ通过在邮件头部增加额外的行以生命ｍｉｍｅ的内容类型

邮件访问协议：从服务器获取邮件　ｐｏｐ　ｉｍａｐ　ｈｔｔｐ等

ｐｏｐ协议

认证过程　客户端命令，服务器响应，事物阶段　ｌｉｓｔ　ｒｅｔｒ　ｄｅｌｅ

ｑｕｉｔ

下载并删除　模式

下载并保持　模式

ｐｏｐ３是无状态协议

ｉｍａｐ　所有消息保存在一个地方：服务器

允许用户利用文件夹组织消息

ｉｍａｐ支持快回话的用户状态



####　dns概述

域名系统

解决的是互联网上的主机/路由器的识别问题

问题：域名和ｉｐ地址之间如何映射

域名解析系统ｄｎｓ　

​     多层命名服务器构成的分布式数据库

　　应用层协议：完成名字的解析

ｄｎｓ：域名向ｉｐ地址等待翻译

　　　　主机别名

　　　　邮件服务器别名

　　　　负载均衡：ｗｅｂ服务器

问题：为什么不使用集中式的ｄｎｓ

　　　　单点失败问题，流量问题，距离问题，维护性问题

　　　结构：

分布式层次式数据库：代价查询次数

本地访问根域名服务器－再到权威域名服务器

顶级域名服务器　负责ｃｏｍ　，ｏｒｇ，ｎｅｔ，

权威域名服务器（学校等）

本地域名解析服务器



本地域名服务器缓存与更新



ｄｎｓ记录和消息格式

资源记录

ｔｙｐｅ＝Ａ　主机域名：ｉｐ地址

ｔｙｐｅ＝ＮＳ　域　该域权威域名解析服务的主机域名

ｔｙｐｅ＝ｃｎａｍｅ　某一真实域名的别名　真实域名

ｔｙｐｅ－ｍｘ 与ｎａｍｅ相对应的邮件服务器



ｄｎｓ协议与消息

ｄｎｓ协议查询和回复　消息

消息格式

消息头部



如何注册域名：

域名管理机构注册域名

向域名管理机构提供你的权威域名解析服务器的名字和ｉｐ地址

域名管理机构向ｃｏｍ顶级域名解析服务中插入两条记录

在权威域名接续服务器中为ｘｘｘｘｘｘ



#### p2p应用：

文件分发：

客户机/服务器ｖｓ。p2p

服务器串行地发送ｎ个副本　　ｎｆ/u

客户机ｉ需要ｆｄ时间下载

p2p

服务器必须发送一个副本f/u

客户机ｉ需要ｆ/d时间下载

总共需要下载ｎｆ比特

最快的可能上传速率　ｕ＋和ｕ



bt协议

动态的加入与离开



p2p索引技术：

文件技术电驴，即时消息ｑｑ



集中式索引

单点失效问题，性能瓶颈，版权问题。

分布式索引（洪泛式查询）

完全分布式架构，

每个节点进行索引

覆盖网络

查询消息通过已有的ｔｃｐ链接发送，

节点转发查询消息，

如果查询命中，则利用反向路径发回查询节点



层次是覆盖网络

介于集中式索引和洪泛式之间的查询

每个节点被分配一个超级节点





###　套接字编程

应用层到传输层

应用进程控制|

ａｐｉ

操作系统控制|



最初的设计　面向ｔｃｐ/ｉｐ协议栈接口

目前

大部分系统都支持

ｉｎｔｅｒｎｅｔ

通信模型

应用进程之间通信的抽象机制

不同进程之间的区分，创建端口号

对外：ｉｐ地址＋端口号

操作系统如何管理（对内）

套接字管理

ｕｎｉｘ　类似于文件的抽象、

当应用进程创建套接字时，操作系统分配一个数据结构存储该套接字相关信息

返回套接字描述符

已定义结构ｓｏｃｋａｄｄｒ_ｉｎ

有地址长度，地址族，端口号，ｉｐ地址，未用



函数ｓｏｃｋｅｔ创建套接字

操作系统返回套接字描述符

第一个参数（协议族）

第二个参数（套接字类型）

第三个参数（协议号）：默认为０

ｔｃｐ：可靠，面向链接，字节流传输，点对点

ｕｄｐ：不可靠，无连接，数据包传输



ｃｌｏｓｅｓｏｃｋｅｔ

关闭一个描述符ｓｄ的套接字

如果多个进程共享一个套接字，调用ｃｌｏｓｅｓｏｃｋｅｔ将套接字引用次数减一，减至０才关闭

一个进程中的多现场呢过对一个套接字使用无计数

返回值　０　成功



ｂｉｎｄ　绑定套接字本地端点地址

ｉｐ＋端口号

参数

客户程序一班不必调用ｂｉｎｄ函数



服务器应该绑定那个地址

解决方案，地址通配符



ｌｉｓｔｅｎ

置服务器端的套接字处于监听状态

仅用于服务器端的调用

仅用于面向链接的流套接字

设置连接请求队列大小

返回值　０　或者失败



ｃｏｎｎｅｃｔ　

客户端调用ｃｏｎｎｅｃｔ来使用客户端套接字ｓｄ与特定计算机的特定端口的套接字进行链接

仅用于客户端



ａｃｃｅｐｔ

创建新的套接字与客户通信

ｓｅｎｄ　ｓｅｎｄｔｏ　发送函数

ｒｅｃｖ，ｒｅｃｖｆｒｏｍ接受函数

ｓｅｔｓｏｃｋｅｔ，ｇｅｔｓｏｃｋｅｔ函数设置套接字选项的参数



关于网络字节顺序

ｔｃｐ/ip定义了标准二进制整数表示



解析服务器ｉｐ地址

　　函数ｉｎｅｔ_ａｄｄｒ（）

　　函数ｇｅｔｈｏｓｔｂｙｎａｍｅ（）实现域名到实名３２位ｉｐ地址转换

解析服务端口号

客户端海可能使用服务名表示服务器端口

将服务名转换位数知的端口号

函数ｇｅｔｓｅｒｖｂｙｎａｍｅ

解析协议号

ｔｃｐ客户端软件流程

１确定服务器ｉｐ地址与端口号

２创建套接字

３分配本地端点地址

４链接服务器

５遵循应用层协议进行通信６

６关闭或者释放





服务器设计

４种基本的服务器

循环无连接服务器基本流程

１穿件套接字

２绑定端点地址

３反复接受来自客户端的请求

４遵循应层的协议，构造响应报文，发送给客户

数据发送

不能服务器使用ｃｏｎｎｅｃｔ函数

无连服务器使用ｓｅｎｄｔｏ函数发送数据包

调用ｒｅｃｖｆｒｏｍ　函数接受数据是，自动提取



循环面向连接服务器基本流程

１创建住套接字，绑定端口号

２设置套接字尾被动监听模式，准备用于服务器

３调用ａｃｃｅｐｔ函数接受下一个连接请求　创建新套接字用于与该客户建立链接

４尊新应用层协议，反复接受客户请求，构造并发送响应

５完成尾特定客户端服务后，关闭与该客户之间的链接，



并发无连接服务器基本流程

主线程１

主线程２



子线程１

子线程２



并发面向连接服务器基本流程



### 传输层

多路复用/分用

可靠数据传输机制

流量控制机制

拥塞控制机制

Ｉｎｔｅｒｎｅｔ的传输层协议

ｕｄｐ：无连接的传输层协议

ｔｃｐ：面向链接的传输服务

ｔｃｐ：拥塞控制



####　宏观

传输层协议为运行在不同ｈｏｓｔ上的进程提供了一种逻辑通信机制

端系统运行传输层协议

发送方，接受方

传输层可以为应用提供多种协议

传输层ｖｓ网络层

网络层提供主机之间的逻辑通信截止，

传输层：提供应用进程之间的逻辑通信机制

ｉｎｔｅｒｎｅｔ传输层协议

可靠的，按序的交付服务ｔｃｐ

　　拥塞控制，流量控制，链接建立

不可靠的交付服务ｕｄｐ

给予尽力而为　的网络层，没有可靠方面性的扩展

都不提供：延迟，带宽　服务





多路复用/分用

分用：主机接受到ｉｐ数据报，主机收到ｓｅｇｍｅｎｔ之后，传输层协议提取ｉｐ地址胡端口信息，将ｓｅｇｍｅｎｔ导向响应的ｓｏｃｋｅｔ７

无连接分用：利用端口号创建ｓｏｃｋｅｔ，

ｕｄｐ的ｓｏｃｋｅｔ用二院标示，

主机收到ｕｄｐ段后

来自不同源ｉｐ地址和/或源端口号的ｉｐ数据包被导向同一个ｓｏｃｋｅｔ



ｕｄｐ给予ｉｎｔｅｒｎｅｔｉｐ协议

服用/分用

错误校验

ｂｅｓｔ　ｅｆｆｏｒｔ　服务

丢失

非按序到达

无连接

不需要握手

单独处理每个段



价值：不需要建立链接　（减少延迟）

实现简单，

头部开销少

没有拥塞控制：



用途：流媒体　容忍丢失，速率敏感

ｕｄｐ实现可靠数据传输

在应用层增加可好数据传输？

发送方：计算校验和１６位

接受方：接受到段的校验和进行比较

进位的最高位被加到地位上



####　可靠的数据传输原理

不错，不丢，不乱，

传输层向上层提供一个可靠的信道

可靠的数据传输协议

ｒｄｔ１．０

底层信道完全可靠

发送方和接受方的fsm独立

发送方就发送，接受方，就接受

ｒｄｔ２．０

底层会产生位错误的信道

如可恢复

确认机制：接受方显示的告诉发送方分组已经正确接受

ｎａｋ：接受方显示地告知发送方分组错误

发送方重新发送

新机制：差错检测，反馈信息，重新发送

实现：发送方：发送，等待反馈，重新发送或不重发　等待反馈

　　　接受方：等待下层，判断，有错，返回ｎａｋ，没有错误，返回ａｃｋ，传到上层

ｒｄｔ２．１和２．２

ｒｄｔ２．０ 问题：反馈消息发生错误

方案１．增加校验，纠错

方案２.添加额外的控制消息

方案３．重发

解决：序列号：发送每个分组增加序列号

接受方丢弃重复分组

２．１增加序列号

２．２取消ａｃｋ，ｎａｋ，校验序列号



ｒｄｔ３．０

可能丢失分组或者发生错误

等待合理时间：没有ａｃｋ重传，如果延迟，

定时器

功能正确，但是性能很差

网络协议有可能限制了硬件的利用

流水线设置

更大范围的序列号

发送方和/或者接受方需要更大的存储空间以缓存分组

滑动窗口协议

窗口：允许使用的序列号范围

　　窗口尺寸尾Ｎ:最多有Ｎ个等待确认的消息

滑动窗口协议

随着协议的运行：窗口在序列号空间向前滑动

协议：ｇｂｎ　ｓｒ



流水线机制：提高资源利用率

流水线协议

发出去确认的，发出去没有确认的，下一个可以用的，不能用的

ｇ-back-n协议

分组头部包含ｋ-bit 序列号

串口尺寸为ｎ,最多允许n个分组未确认

ａｃｋ：确认到序列号为n的分组均已被正确接收

为空中的分组设置计时器

超市时间：重传系列号大于等于ｎ,还没有收到ａｃｋ的所有分组

确认拥有最高序列号，已被正确接受的分组ａｋｄ，乱序就丢弃

后退ｎ帧，看最大确定帧，例题里３被确认了，说明１的　确认　丢失了

饭４５６７就行



ｇｂｎ缺陷，后退ｎ帧有浪费

ｓｒ多了一个接收的缓存窗口，只发送没有接受的分组，乱序缓存

ｓｒ困境　可用序列号比较少



#### tcp协议

点对点

可靠，按需的字节流

流水线机制

发送方/接受方缓存

全双工

面向链接

流量控制





段结构：

序列号：建立的时候是随机的

ａｃｋ：累计确认：该序列号之前的所有字节均以被正确接收到

ｑ：如何处理乱序到达的ｓｅｇｍｅｎｔ

Ａ：ｔｃｐ规范中没有规定，有ｔｃｐ的实现着做出决策



ｔｃｐ的可靠数据传输：

ｔｃｐ在ｉｐ层的不可靠服务基础上实现可靠数据传输

流水线机制

累计确认

ｔｃｐ使用单一重传定时器

触发重传的事件

渐进式



ｒｔｔ和超时

定时器事件确定问题

大于ｒｔｔ但是ｒｔｔ是变化的

过短，不必要的重传，过长丢失时间反应慢

问题：如何估计ｒｔｔ，ｓａｍｐｌｅｒｔｔ测量从段发出去到收到ａｃｋ的事件

ｒｔｔ辩护求平均值形成ｒｔｔ估计

安全边界：

ｓａｍｒｔｔ与ｅｓｔｒｔｔ的差值

ｄｅｖｒｔｔ

定时器超时时间设置



ｔｃｐ发送方事件

从应用层收到数据

创建ｓｅｇｍｅｎｔ　序列号是ｓｅｇｍｅｎｔ第一个字节编号

开启计时器，设置超时时间，

超时：重传超时的一个

收到ａｃｋ，如果确认此前从未确认的ｓｅｇｍｅｎｔ更行ｓｅｎｄｂａｓｅ



快速重传机制：

ｔｃｐ实现中，如果发生超时，超时时间间隔将重新设置，即将超时事件间隔加倍

导致其很大

ｔｃｐ流量控制：

接收方为ｔｃｐ链接分配ｂｕｆｆｅｒ

上层应用可能处理ｂｕｆｆｅｒ中数据的速度较慢。



ｔｃｐ的链接管理

链接的发起者是等待客户去请求

三次握手，

客户端ｓｙｎ建立连接

服务器ｓｙｎａｃｋ报文

客户机答复一个ａｃｋ报文段



ｔｃｐ链接管理关闭：四次握手

客户发送ｆｉｎ，

服务器回复ａｃｋ，关闭连接，发送ｆｉｎ

客户收到ｆｉｎ回复ａｃｋ，进入等待如果收到ｆｉｎ重新发送ａｃｋ

服务器收到ａｃｋ，链接关闭



拥塞控制：

分足丢失（路由器缓存溢出）

分组延迟过大（在路由器缓存中带队）

拥塞控制（网络）　ｖｓ流量控制（双方）

吞吐率：　一阶线性，

时延：快速增大

代价：上游的处理处理被浪费掉了



管制网络发送方发送的数据

端到端的控制

网络辅助的拥塞控制

路由器向发送发送反馈网络拥塞信息

指示发送发应该采取何种速率



ａｂｒ网络辅助：负载低尽量用，负载高发的低，

ｒｍ发送发发送，交换机设置ｒｍｃｅｌｌ位，ｒｍｃｅｌｌ由接收方返回给发送方

数据ｃｅｌｌ，资源管理ｃｅｌｌ，有拥塞和速率　



ｔｃｐ拥塞控制基本原理

如何感知网络拥塞

加性增乘性减：

原理：慢慢加，过大的时候，处于２

慢启动：ｓｓ

原理，当链接开始时，指数性增长，

实现方法：

ｌｏｓｓ事件：

３个重复的ａｃｋ，剪切到一半，ｔｉｍｅｏｕｔ事件：直接设位１ｍｓｓ

然后指数增长，达到ｔｈｒｅｓｈｏｌｄ后再线性增长

ｔｉｍｅｏｕｔ到时是从一开始１，三个ａｃｋ是减为一半

ｃｏｎｇｗｉｎ　

ｔｈｒｅｓｈｏｌｄ变成２分之一窗口



吞吐率　

ｗ/rtt

公平性



### 网络层

转发，转发表（广义地址），

路由　路由协议，路由算法

链接的建立，链路重的每一个都需要链接

网络层：主机到主机，（路径上的路由器等网络设备参与其中）

传输层　：两个应用进程之间（对中间网络设备透明）



ｉｎｔｅｒｎｅｔ尽力服务

很多保证没有，

ａｔｍ网络

网络有不同的服务模型很多大概分为

无连接的模型

有链接的模型

有链接的网络



最大传输单元（mtu）采用最小的ｍｔｕ

１个ｉｐ分组分为多片ｉｐ分组

ｉｐ分片到达目的主机后进行“重组”

ｉｐ首部的相关字段用于标识分片以及缺点分片顺序

总长度，标识，标志位和片偏移

标识字段：占１６位：标识一个ｉｐ分组

标志位：占３位　ｄｆ禁止分片，允许分片

ｍｆ非最后一片，最有一片

片偏移：１３位，封装一个ｉｐ分组数据报相对偏移量

以８字节位单位

一个最大分片可封装应该是８的倍数，因此，一个最大分片可分装的数据为

ｄ=[m-20/8]*8

需要的总片数为：ｎ*【ｌ-20/8】

偏移量

每片的总长度

每片的ｍｆ标志为：

４０００

１４８０　　　０

１４８０　　　１８５

１０４０　　　３７０



ｉｐ分组

　　源地址（ｓａ从哪来）

　　目的地址（ｄａ到哪去）

接口：主机/路由器与物理链路的链接

ｉｐ地址：编号标识主机，路由器的接口。

ｉｐ地址与每个接口关联

ｉｐ地址分配

高比特网络号

低比特主机号

ip子网：ｉｐ地址具有相同的网络设备接口

　　通常不跨越路由器（第三及以上层网络设备）

有类编址：

Ａ类地址８　　５０  0.0.0.127.255.255.255

Ｂ类地址　　　１６　128.0.0.0-191.255.255.255

c类地址　　　　２４　192.0.0.0-233.255.255.255

d类地址多播地址２２４－２３９

ｅ类地址保留２４０

有特殊地址，不能分给主机地址有特殊作用

私有地址：（只能在公司内部使用，公共网络不认识这些地址）

ａ：１０

ｂ：１７２．１６－１７２．３１

ｃ：１９２．１６８．０－１９２．１６８．２５５



有类地址网络缺陷：不灵活

ｉｐ地址网络号：高比特

子网号：原网络主机号

主机号：地比特

子网掩码：３２位

取值：ｎｅｔ，ｓｕｂｉｄ位全取１

ｈｏｓｔｉｄ位全取０

ａ的默认子网掩码２５５．０．０．０

ｃ网：划分为等长的子网



无类域间路由ｃｉｄｒ　

消除传统的ａ类，ｂ类，ｃ类地址界限

融合子网掩码与子网掩码，方便子网划分

融合子网地址与子网掩码，方便子网划分

无类地址格式，a.b.c.d/x

提高ｉｐｖ４地址空间分配效率

提高路由效率　

将多个子网聚合为较大的子网

构造超网

路由聚和

２２３．１．０．０／２２

等于

２２３．１．１．０／２３

２２３．１．１．３／２４

由于ｉｐ分配不均匀会出现黑洞现象

所以有最长前缀匹配优先，在他的上层ｉｓｐ中添加一个路由信息



ｄｈｃｐ协议

主机如何获取地址

硬编码:静态配置，默认网关，送到某个接口

动态主机配置协议－ｄｈｃｐ

从服务器动态获取

　ｉｐ地址

　子网掩码

　默认网关地址

　ｄｎｓ服务器名称与ｉｐ地址

“即插即用”

允许地址重用

支持在用地址续租

支持移动用户加入网络



主机获取ｉｐ地址

主机广播：发现报文

ｄｈｃｐ服务器利用　提供报文进行响应

主机请求ｉｐ地址，请求报文

ｄｈｃｐ确认报文

ｄｈｃｐ协议在应用层实现，请求报文封装到ｕｄｐ数据报中

ｉｐ广播

链路层广播（以太网）



有租用期，家庭，实验室啥的



ｎａｔ网络地址转换

一个ｉｐ智能申请一个ｉｐ地址

　　ｉｐｖ４耗尽

本地网络设备ｉｐ地址的变更，无需通告外界网络

变更ｉｓｐ时，无需修改内部网络设备

内部网络设备对外界网络不可见，即不可直接寻址（安全）

实现：

　替换：利用替换每个外出ｉｐ数据报的（源ｉｐ地址，源端口号）

　记录：将没对与的替换信息存储到ｎａｔ转换表中

　替换：根据ｎａｔ转换表利用（源ｉｐ地址，源端口号）替换每个进入内网ｉｐ数据报的（目的端口号），即（ｎａｔ　ｉｐ地址，新端口号）

问题：

利用端口号：可以同时支持６０００多并行链接

ｎａｔ争议；路由器应该只处理第三层功能

违背端到端通信原则

　应用开发者必须考虑ｎａｔ的存在　　ｐ２ｐ

地址短缺问题应该由ｉｐｖ６来解决

ｎａｔ穿透问题：

例如：服务器在内网

解决方案：１：静态配置ｎａｔ，将特定端口的链接请求转发给服务器

利用ｕｐｎｐ互联网网关设备协议



２自动配置：学习到ｎａｔ公告ｉｐ地址

在ｎａｔ转发表中，增删端口映射



３中继：ｎａｔ内部的客户与中继服务器建立连接

外部客户也与中继服务器建立链接

中继服务器桥接两个分组



互联网控制报文协议（ｉｃｍｐ）

支持主机或路由器

差错报告

网络探寻

两类ｉｃｍｐ报文

差错报告报文

目的不可达

源抑制



例题：

ｘｘｘｘ



路由和转发

确定去往目的的网络的最佳路径

网路抽象：图

图抽象：费用，

　　每段链路费用可以总是１，或者是宽带倒数，拥塞程度等

路径费用：

关键问题：源到目的的最小费用路径是生么

路由算法：寻找最小费用路径算法

静态路由　ｖｓ动态路由

静态路由：

手工配置

路由更新慢

优先级高

动态路由：

路由更新快，定期更新

及时响应连路费用或网络拓扑变化

全局信息　ｖｓ分散信息

全局信息所有路由器完整网络拓扑和连路费用信息

ｅｇ。链路状态路由算法

分散信息：

路由器只掌握物理相连的邻居以及链路费用

邻居信息交换，运算的迭代过程

ｅｇ距离向量路由算法



网络抽象：

链路状态路由算法

ｄｉｊｋｓｔｒａ算法

所有节点掌握网络拓扑和链路费用

　通过“链路状态广播”

　所有节点拥有相同信息

计算从一个节点

到达所有其他节点的最短路径



获得该节点的转发表

迭代ｋ次，后得到到达ｋ个目的节点的最短路径

如果不相连位无穷大

从源到目的的当前路径费用值

ｐ（ｖ）沿从源到ｖ的当前路径，ｖ的前序节点

ｎ：已经找到最小费用的节点集合



执行完算法之后获得了一个最短路径树

形成转发表

存在震荡现象可能：

假设链路费用是该链路承载的通信量：随着更新到达Ａ的节点的通信量总是０

会因为ｔｔｌ等于０被丢掉



距离向量路由算法

ｂｅｌｌｍａｎ－ｆｏｒｄ

异步迭代：引发每次局部迭代的因素，

局部链路费用改变

来自邻居的ｄｖ更新

分布式：每个节点只当ｄｖ变化时才通告给邻居

邻居在必要时在告诉他们的邻居

每个节点：等待

重新计算ｄｖ估计

如果ｄｖ中到达任一的距离发生改变，通告所有邻居



问题：好消息传播快，坏消息传播慢

怪消息：无穷计数问题

毒性逆转，如果一个节点到达某个目的费用路径是通过某个邻居，则：

通过给该邻居节点到达该目的的距离位无穷大

定义最大的有效费用值：



层次路由（大规模网络）：

标识所有路由器不可行

‘’扁平‘’网络

－－在世纪网络中不可行

网络规模：６个亿　无法存储，计算量过大

管理自治：每个网络的管理，

聚合路由器位一个区域：自制系统ａｓ

同一ａｓ内的路由器运行相同的路由协议算法

不同自制系统内路由器可以运行不同的ａｓ内部路由协议

网关路由器：位于ａｓ边缘

通过链路链接其他ａｓ的网关路由器

互联的ａｓ转发表由ａｓ内部路由算法与ａｓ间路由算法共同配置

ａｓ内部路由算法设置

ａｓ内部的网络路由器入口

ａｓ内部路由算法与ａｓ间路由算法共同设置，ｓａ外部目的网络路由入口

热土豆路由：将分组转发给最近的网关路由器

ｉｎｔｅｒｎｅｔ采用层次路由

ａｓ内部路由协议也成位内部网络协议ｉｇｐ

最常见的ａｓ内部路由协议

路由信息协议

开放最短路径优先

内部网关协议



距离向量路由算法

距离度量：跳步数：，每条链路１个跳步

每隔３０秒，邻居之间交换一个ｄｖ，成为通告

每次通告：最多２５个目的子网（ｉｐ地址形式）

ｒｉｐ举例：　路由器的路由表

链路失效，回复

如果１８０灭有收到通告－》邻居/链路失效

经过该邻居的路由不可用

向邻居发送信道通告

邻居再次依据向外发送通告

链路失效信息能否快四传递到全网

毒性逆转技术用于预防乒乓环路

ｒｉｐ路由表利用一个称作ｒｏｕｔｅ－ｄ的应用进程进行管理

应用进程实现

通告报文周期性地通过ｕｄｐ数据报发送

####　自治系统内：

ｏｓｐｆ协议简介

”开放“：公共可用

采用链路状态路由算法

　ｌｓ分组扩散（通告）

每个路由器构造完整的网络，拓扑图

利用递交上突然算法计算路由

ｏｓｐｆ通告总每个入口对应一个邻居



ｏｓｐｆ所有报文可以被认证

允许使用多条相同费用的路径

分层的ｏｓｐｆ，两级分层

ａｓ边界路由器，链接其他ａｓ



#### 自制系统间：

ｂｇｐ协议

系统会话：连个ｂｇｐ路由器交换报文

通过报文去往不同目的前缀的路径

报文交换基于半永久的ｔｃｐ链接

ｂｇｐ报文：

ｏｐｅｎ：与ｐｅｅｒ建立ｔｃｐ链接，并认证发送方

ｕｐｄａｔｅ：通告新路径

ｋｅｅｐａｌｉｖｅ：在无ｕｏｄａｔｅ时，活链接，也用于对ｏｐｅｎ的确认

ｎｏｔｉｆｉｃａｔｉｏｎ：报告先前报文的炒作；也用于关闭链接

当爱上

公告一个前缀个ａｓ时

ａｓ承诺可以将数据报转发给该子网

ａｓ３在通告中聚合网络前缀



为什么采用不同的ａｓ内与ａｓ间路由协议

策略：

间：期望能够管理控制流量如何被路由，被谁路由

内：单一管理，无需策略决策

规模：

层次路由节省路由表大小，减少路由更新流量

适应大规模互联网

性能：

ｉｔｒａ－ａｓ：侧重性能

ｉｎｔｅｒ－ａｓ：策略主导



### 数据链路层

主机和路由器：节点

链接相邻通信信道：链路

有线链路

无线链路

局域网

链路层数据分组：帧，分装网络层数据报

数据链路层负责通过一条从一个节点向另一个物理链路直接相连节点传送数据报



#### 服务

组帧：封装数据报构成数据帧，加首部尾部，帧同步

链路接入：如果是共享介质，需要解决信道接入，帧首部中的"mac"的地址，用于标识的源和目的

相邻节点间可靠交付：

在低误码率的有线链路上很少采用（如光钎，某些双绞线等）

无线链路：误码率高。需要可靠交付

流量控制：协调相邻的发送节点

差错检测：信号衰减和噪声会引起差错，接收端检测到差错*通知发送端重传或者直接丢弃帧

差错纠正：接收端直接纠正比特差错

全双工和半双工通信

全双工通信：链路两端节点通知双向传输

半双工：交替双向传输

发送端：将数据封装成帧

接收端：检测差错，实现可靠数据传输和流量控制

提取数据报，交付上层协议实体



差错检测：差错编码

差错编码不是１００可靠

差错检测能力可以分为检错码与纠错码

对于检错码，级的

１比特校验位：奇偶校验位

二维奇偶校验检测奇数位，部分偶数位差错

纠正同一行/列的奇数位错

ｉｎｔｅｒｎｅｔ校验和

发送端：１６进制相加，补码求和，校验和的反码，放入分组

接收端：形同计算，对比

循环冗余校验码：

检错能力强大



多路访问控制（ｍａｃ）协议：

两类“链路”：

点对点：

拨号接入的ｐｐｐ

以太网交换机与主机间的点对地啊链路

广播链路（共享机制）



单一共享广播信道

两个或者两个以上节点同事传输：干扰

冲突：节点同时接受两个或者多个信号－接受失败

多路访问控制协议

分布式算法决定节点如何共享，

理想的ｍａｃ协议

给定：速率ｒ为广播信道

期望：速率高，平均速录稳定，完全分散，简单

三大类：

信道划分协议，多路复用技术

随机访问协议，信道不划分，允许冲突

轮转ｍａｃ协议

节点轮流使用信道

ｔｃｍａ周期性接入信道

每个站点在每个占用固定时隙

位用时隙空闲

随机访问ｍａｃ协议

当节点要发送分组时：利用信道全部数据速率ｒ发送分组

没有事先的节点间协调

两个或多个节点同事传出；——》“冲突”

随机访问ｍａｃ协议需要定义

如何检测冲突

如何从冲突中恢复

时隙ａｌｏｈａ

假定：所有帧大小相同，时间被胡凡为等长的时隙

节点只能在时隙开始是个发送帧

节点间时钟同步

如果２个或者２个节点在同一时隙发送帧，节点即检测到冲突

优点：单个节点活动时，可以连续以信道全部速率传送数据

高度分散化：只需同步时隙

简单

缺点：

冲突，浪费时隙

空闲时隙

节点也许能以远小与分组传送时间检测到冲突

时钟同步

效率：长期运行发送帧，所占比例

信道成功被利用时间



Ａｌｏｈａ协议

非时隙：更加简单，无需同步

立即发送

冲突可能性增大

比时隙ａｌｏｈａ协议更差（夏威夷的你好）



ｃｓｍａ协议

载波监听多路访问协议

发送帧之前，监听信道（载波）

信道空闲：发送完整帧

信道忙:推迟发送

冲突可能仍然发送

信号传播延迟

继续发送冲突帧：浪费信道资源

ｃｓｍａ/cd协议

短时间内可以检测到冲突

冲突后传输终止，减少信道浪费

冲突检测：

有线局域网易于实现：

无线局域网很难实现：

“边发边听，不发不听”

信道划分ｍａｃ协议

网络负载重时，共享信道效率高，且公平

网络负载轻，共享信道效率低

随机访问ｍａｃ协议

网络负载轻时，共享效率高，单个节点可以利用信道的全部带宽

网络负载重时，产生冲突开销

轮状访问ｍａｃ协议

综合两者的优点

轮询：主节点轮流“邀请”从属节点发送数据，典型应用：“哑”从属设备

问题：轮训开销

　　　等待延迟

　　　单点故障

令牌传递：控制令牌以此从一个节点到下一个节点，

令牌：特殊帧

令牌开销

等待延迟

单点故障



ｍａｃ协议总结

时间，频带，码片划分

信道划分协议

ｔｄｍａ，ｆｄｍａ，ｃｄｍａ

随机访问ｍａｃ协议

ａｌｏｈａ，ｓ－ａｌｏｈａ，　ｃｓｍａ，ｃｓｍａ/cd

csma/cd 应用与以太网

ｃｓｍａ/ca应用与８０２．１１无线局域网

轮转协议ｍａｃ协议

主节点轮训：令牌

蓝牙，ｆｄｄｉ，令牌环网



#### ＭＡＣ地址

ｉｐ地址有３２位

接口的网络层地址

用于标识网络层分组，支持分组转发

ＭＡＣ地址

作用：用于局域网内标识一个帧从那个接口发出，到达那个物理相连的其他借口

４８位ｍａｃ地址，固话在网卡的ｒｏｍ中，有时也可以软件设置

ｍａｃ地址有ｉｅｅｅ统一管理与分配

网卡生产厂商购买ｍａｃ地址空间

类比：

ｍａｃ地址：身份证号

ｉｐ地址：邮政地址

ｍａｃ地址是平面地活着：可携带“携带”

可以从一个ｌａｎ移到另一个ｌａｎ

ｉｐ地址是层次地址：不可携带

ｉｐ地址依赖于节点链接到那个子网

ａｒｐ地址解析协议

ａｒｐ表：ｌａｎ中的每个ｉｐ节点维护一个表存储某些ｌａｎ节点的ｉｐｍａｃ地址映射关系

<ｉｐ地址；ｍａｃ地址；ｔｔｌ>

ｔｔｌ进过这个时间后该映射关系会被遗弃掉

##### ａｒｐ协议：同一局域网内

ａ想要给同于局域网内的ｂ发送数据报

ｂ的ｍａｃ地址不在ａ的ａｒｐ表中

ａ广播ａｒｐ查询分组，其中包含ｂ的ｉｐ地址

ｂ接受ａｒｐ查询分组，ｉｐ地址匹配成功，向ａ答应ｂ的ｍａｃ地址

ａ在其ａｒｐ表中，缓存ｂ的ｉｐ－ｍａｃ地址对，直至超时

ａｒｐ是即插即用协议

节点自住创建ａｒｐ表

无需干预

##### ａｒｐ协议：不是一个局域网内

从一个ｌａｎ路由至另一个ｌａｎ

通信过程：ａ通过路由器ｒ向ｂ发送数据报

关注寻址：ｉｐ地址（数据报）和ｍａｃ地址（帧中）

假设ａ知道ｂ低ｉｐ地址（怎么知道的？应用层）

假设ａ知道第一跳路由器ｒ（左）接口ｉｐ地址（怎么知道的？默认网关）

假设ａ知道下一跳路由器ｒ（左）接口ｍａｃ地址（怎么知道的？ａｒｐ协议）

实际转发是ａ获取网关地址，获取网关ｍａｃ地址，发给网关，网关获取ｂｉｐ地址，ｍａｃ地址，发给ｂ（相邻局域网）



####　有线局域网　以太网

通知地位的ｌａｎ技术

造价低，应用最广泛的ｌａｎ技术，比令牌局域网和ａｔｍ更简单，便宜

满足网络速率需求

总线（ｂｕｓ）上世纪９０年代中期前流行

所有节点在统一冲突域（可能彼此）

星型：目前主流网络拓扑网

中心交换机

每个节点一个单独冲突域（节点间彼此不冲突）

无连接：发送帧的网卡与接收帧的网卡没有握手过程

不可靠：接收网卡不向发送网卡进行确认

差错帧直接丢弃，丢弃帧中的数据回复依靠高层协议，否则发生数据丢失

以太网的ｍａｃ协议：采用二进制指数退避算法的ｃｓｍａ/cd

ｎｉｃ从网络层接收数据报，创建数据帧

监听信道

如果监听到信道空闲，则开始发送帧，反之，股发送

ｎｉｃ发送完整个帧，而没哟偶检测到其他节点的数据发送，则ｎｉｃ确认帧发送成功

如果ｎｉｃ检测到有其他节点数据发送，则终止发送

并发送拥堵信号

终止发送后，ｎｉｃ进入二进制指数退避



以太网帧结构：以太网帧结构

发送端网卡ｉｐ数据报（或其他层协议分组）

分装到以太网中。

前导码　用于发送端与接受端的始终同步

目的ｍａｃ地址，源ｍａｃ地址（各６ｂ）

如果网卡的ｍａｃ地址与收到的帧的目的ｍａｃ地址匹配，

类型

数据

ｃｒｃ（４ｂ）



####　交换机

链路层设备

存储转发以太网帧

检测到达的目的ｍａｃ地址，选择性

向一或者多个输出链路转发帧

利用ｃｓｍａ/cd访问链路，发送帧

透明

　　主机感知不到交换机的存在

即插即用

自学习

多端口同间传送

交换与的传输可以同事进行，没有冲突

交换表：里面是ｍａｃ地址

交换机：帧过滤/转发



自学习与转发过程举例

（已知）泛洪，（未知）选择性转发

交换机互联

自学习（与单一交换机情形相同）

组织机构网络（ｉｐ子网）

几种网路设备：

路由器：

交换机：

网桥：

集线器：



####　虚拟局域网

ｖｌａｎｓ：动机　（广播隔离）

虚拟局域网

流量隔离

动态成员

在ｖｌａｎ间转发：通过路由（就像在独立的交换机之间）

实际中常见会吧交换机与路由器集成在一起

多线缆链接：每个线缆链接一个ｖｌａｎ

中继端口：

#### ｐｐｐ协议 点对点

一个发送端，一个接收端，一条链路：比广播链路容易

无需介质访问控制

无需明确的ｍａｃ寻址

常见的点对点数据链路控制协议

组帧：将网络层封装到数据报数据链路层帧中

可以同时承载任何网络层协议分组

可以向上实现分用

比特透明传输：数据域必须支持承载任何比特模式

差错检测：（无纠正）

链接活性：检测，并向网络层通知链路失效

网络层地址协商：端节点可以学习/配置彼此网络地址

标志：定界符

地址：是无效的

控制：是无效的

协议：上层协议（ｉｐ，ｉｐｃｐ）

信息：上层协议分组

校验：ｃｒｃ校验，用于差错检测



字节填充

数据透明传输

发送端：填充０１１１１１０

接收端：丢弃

配置ｐｐｐ链路

　最大帧长

　身份认证

学习/配置网络层信息



#### 无线局域网：

基站模式特定网自组模式

基站-访问点



关联过程：

被动扫描：

主动扫描：

多路访问控制：

避免冲突：



### 网络安全

互联网普及率47.8%

发展总体平稳，形式严峻，

云服务日益成为网络攻击重点目标

域名系统面临严峻的拒绝服务攻击

针对重要网站的域名解析篡改攻击频发

网络攻击威胁逐渐向工业互联网渗透

分布式反射性攻击逐渐成为拒绝服务供给的重要形式

基础应用或通用软硬件漏洞风险凸显

漏洞风险向传统领域，智能终端领域泛华演进

网站数据和个人信息泄露

移动应用程序成为数据泄露的新主体

具有短信拦截功能的移动恶意程序爆发

针对金融，电信行业的网页仿冒使劲大幅增加

钓鱼站点逐渐向云平台迁移

针对政府部门和中烟行业单位网站的网络攻击频度，烈度，复杂度加剧



#### 网络安全

网络安全是指网络系统硬件，软件及其系统中的数据收到保护，不因偶然的或者恶意的元婴而收到破坏，更改，泄露，系统连续可靠正常地运行，网络服务不中断

基本属性：

机密性：

身份认证：

信息的完整性

可访问性与可用性

相对性

时效性

相关性

不确定性

复杂性

重要性

##### 网络安全研究领域

分析入侵者

如何防护网络对抗攻击

如何设计网络体系结构免疫攻击

internet最初的设计几乎没有考虑安全性

网路安全需要在各个层面

##### 拟人网络场景

三个人，两个进行交流，一个进行破坏

病毒，蠕虫，间谍，

##### 病毒能做什么

窃听，插入，假冒，劫持（会拿走），拒绝服务

映射，发起攻击前“探路”-

利用ping命令确定网络主机地址

端口扫描，以此尝试与每个端口建立tcp链接



对策：

记录到达的网路流量

分析，识别出可疑活动

分组嗅探

* 广播介质
* 混杂模式网络接口



分组嗅探：对策

组织中所有主机都运行软件，周期性检测网络链接

ip欺骗

对策：入口过滤

有效：但是不能强制所有网络都实现



拒绝服务：

向接收方恶意泛红分组，淹没接收方

宽带耗尽，资源耗尽

分布式拒绝攻击：先选择目标，构建僵尸网络

反射式ddos攻击：先选择目标，构建僵尸网络，选择反射服务器

对策：过滤泛红分组，（好的坏的，一起扔）

syn攻击：建立大量链接



#### 密码学基础

秘钥

m明文

ka密文，加密

对称秘钥解密

非对称秘钥（公开秘钥，私有秘钥）

​              q：秘钥分发问题

唯密文攻击

两条途径：暴力破解

统计分析

已知明文攻击，获得一定的秘钥

选择明文攻击：知道一点对称字母

#### 传统加密方法

替代密码，

​      凯撒密码，单码替代密码

​      多字母替代加密

   

 换位密码：重新排序明文中的字母置换法

​     换位密码：列置换，矩阵列数和输出顺序可以用一个单词来表示，可以用一个单词来表示、

现代加密技术主要分为

对称秘钥加密

非对称秘钥加密

对称秘钥加密

  流密码，

分组密码（更广泛）

分组长度，分组长度越大，安全性越高，加密速度越慢

秘钥的大小

循环次数

子秘钥产生算法

轮函数

数据加密标准：des算法

ibm公司研制

des是16轮加密有64字节最终使用的是56比特

des的安全性：弱秘钥，半弱秘钥

#### 高级加密标准aes

xxxx

公开秘钥加密

完全不同的两种方法

通过公钥，不能算出私钥

x mod n =x

加密解密

取模

安全性：将两个大素数相乘在计算上容易实现，二将该成绩分解的计算量相当大

rsa实际应用运算轻度非常大

利用公钥建立安全链接，然后建立第二额个秘钥-对称会话秘钥。用于加密数据

会话秘钥

bob与alice利用rsa交换对称会话秘钥ks

一旦双方确认ks 则利用会话秘钥加密解密会话数据



#### 身份认证

ap1.0 ap2.0 ap3.0（嗅探）ap3.1（回放攻击）

ap4.0（避免回放攻击），一次性随机数：一个生周期内只用一次的数r（共享秘钥）

缺点：需要有一个共享秘钥

ap5.0：缺陷（中间人攻击）



#### 报文完整性

报文摘要：

报文认证：报文+报文摘要 -》扩展报文

缺陷：只能认证报文的完整新，无法验证人

报文验证码mac 报文m+认证秘钥s+密码散列函数-》扩展报文

缺陷：知道秘钥的话，可以完全伪造

mac缺陷：

否认，伪造，冒充，篡改，

A：数字签名 技术是实现安全电子交易的核心技术之一

可验证性，不可伪造性，不可抵赖性。

对报文m的简单数字签名：

报文加密技术是数字签名的基础

通过利用其私钥秘钥对m进行加密。

大报文m散列函数，数字签名，数字加密，加密报文，

alice合适签名以及数字签名报文的完整性

回顾身份认证协议

目标：避免回访攻击

一次性随机数：一个生命期内只用一个的数r

ap4.0为了验证是“真是的”alice，bob向alice发送一个随机数r，alice必须返回r，并利用共享秘钥进行加密。

#### 对称秘钥分发问题

两个实体在网上如何建立共享秘钥

（对称秘钥）kdc一个服务器

注册信息，和与其kdc的秘密密钥



#### 公钥分发问题：

公钥问题：真假问题

认证中心：实现特定实体e与其公钥的绑定。

每个e（如人，路由器等）在ca上注册其公钥

e向ca提供“身份验证”

ca创建绑定e及其公钥的证书

证书包含由ca签名的e的公钥-ca声明：“这是e的公钥”

认证中心：





#### 电子邮件安全威胁

垃圾邮件

邮件诈骗

邮件炸弹

通过电子邮件/附件传播网络蠕虫/病毒

电子邮件欺骗，钓鱼式攻击

#### 电子邮件安全需求

机密性

完整性

身份认证

抗抵赖性

#### 安全电子邮件基本原理

邮件具有单向性和非事实性

，不能通过建立隧道来保证安全，只能对邮件本身加密

alice用bob的公开秘钥加密对称秘钥

发送

bob解密得到对称秘钥

alice以公开，认证，用数字签名

alice使用3个秘钥：她自己的私钥，bob的公钥和新生成的对称秘钥

#### 安全电子邮件pem标准

邮件加密，报文完整性，发送方的认证，防发送方的低认

pgp标准：安全，免费

还可用于普通文件加密以军事目的

所用算发被证实位非常安全、

   公钥加密算法

   对称加密算法

   散列算法

pgp特点：

对邮件内容尽心数字签名，保证信件内容不被篡改，

使用公钥和对称加密保证邮件内容机密且不可否认

公钥的权威性由收发双方或所信任的第三方签名认证

实现不需要任何保密信息来传递对称会话秘钥

pgp功能框架：

pgp秘钥：

安装时会生成一个公开秘钥对

 公钥放置用户网站或某公钥服务器上

私钥则使用用户口令进行保护

  用户为随机生成的rsa私钥指定一个口令，只有给出口令才能将私钥释放出来

pgp公钥认证机制与传统ca差异较大

pgp公钥可以通过可信的web认证

用户可以自己认证自己任何其信任的“公钥/用户名”对

用户还可以以为其他公钥认证提供“担保”

防止篡改公钥的方法

直接从bob手中得到其公钥

通过电话认证秘钥

从双方信任的david哪里获得bob的公钥

通过ca

s/mime标准



#### web安全威胁

机密性，完整性，拒绝服务，身份认证

web服务越强大，包含的安全漏洞概率越大

http服务可在不同权限下运行

web浏览器的安全威胁

可能隐藏恶意程序

通信信道的安全威胁

监听，伪造，篡改，等

基于应用层实现web安全

ssl或者tls可作为基础协议栈的组成部分，对应用透明

，也可直接嵌入到浏览器

使用ssl或tls后，传送的应用层



安全套接字：

https在使用ssl

实现netscape

变体tls

提供：机密性，完整性，认证，

最初目标 web电子商务交易，加密，web服务器认证，可选的客户认证

方便与新商户的商务活动

可用于所有基于tcp网络应用：安全socket接口

ssl提供应用编程接口



（toy）ssl一个安全的信道

握手：

握手：利用他们的证书，私钥认证彼此，以交换共享秘钥

秘钥派生：alice和bob利用共享秘钥派生出一组秘钥

数据传输：带传输数据分割成一系列记录

链接关闭：通过发送特殊消息，安全关闭链接

ms：

ems：加密的主密钥

ssl秘钥派生

不同加密操作使用不同秘钥会更加安全

例如：报文认证码秘钥和数据加密秘钥

4个秘钥

kc用于加密客户向服务器发送互数据秘钥

ks用于加密服务器向客户发送数据秘钥

ms用户服务器向客户发送的秘钥



ssl密码组

公开密码算法

对称加密算法

ssl支持多个密码组协商

ssl更改密码规格协议

警告协议：alert消息

 位于ssl记录协议之上

ssl握手协议

协商结果是ssl记录协议基础

协商结果是ssl记录协议基础

ssl的握手过程用到三个协议：握手协议，更改密码规格协议和警告

ssl记录协议



ssl握手协议：

1客户发送一个随机数

2服务器从算法列表中选择算法，并发回给客户

选择+证书+服务器一次随机数

3客户验证证书

4客户与服务器基于预主机密码

5客户与服务器基于预主秘钥和一次随机数分别独立计算加密秘钥和mac秘钥

6客户发送一个针对所有握手消息的mac

最后2步的意义：保护握手过程免遭篡改

ssl记录协议：数据分段，压缩，计算mac至，加入记录

进行tcp传输

客户一次输，服务器，输入位伪随机数发生器

主密码和新一次随机数输入另一个随机数发生器

“秘钥快”

秘钥切片

客户mac秘钥服务器mac秘钥

xxxx

x



#### 虚拟专用网络

##### 专用网

动机：安全

专用网络pn：基于专属网络设备



虚拟专用网络：

建立在公共网络之间上的安全通道，实现远程用户，分支结构，业务伙伴，等与机构总部网络的安全链接，从而构建针对特定组织机构的专用网络，

虚拟“安全通道”不实际独占网络公共资源，是一条逻辑的穿越公共网络的安全，稳定的隧道

逻辑连接

通过隧道技术，加密技术，秘钥管理，认证和访问控制等，实现与专用网类似的安全性能

数据机密性保护

数据完整性认证

数据源省份攻击

防重放攻击

访问控制

vpn关键技术

隧道技术

数据加密

身份认证

秘钥管理

访问控制

网络管理

隧道技术：通过internet提供安全的点到点的数据传输“”安全通道

实质上是一种封装

vpn隧道利用隧道协议对通过隧道传输的数据进行封装

* 使数据安全穿越公共网络
* 通过加密和认证确保安全
* 数据包进入隧道时，由vpn分装成ip数据报
* 通过隧道在internet上安全传输
* 离开隧道后，进行解封装，数据便不在被保护

隧道协议：

乘客协议

分装协议

承载协议（ip协议）

常见vpn协议，pptp协议 l2tp协议

第三层ipsec协议

不支持拨号访问



#### ipsec服务

机密性，数据完整性，源认证/鉴别，重放攻击预防

传输模式： 

​      主机模式

​      隧道模式

两个ipsec协议

提供ipsec服务的两个协议

ah协议：在ip数据报协议号位51

esp协议：在ip数据报头中协议号位50

认证头协议ah：提供源认证和数据报完整性检验

但不提供机密性

分装安全协议esp

提供源认证/鉴别，数据完整性检验以及机密性

有4种组合：

2*2



sa安全管理员：

sa单向的逻辑链接

tcp（之后建立链接维护，端口号，等）

ipsec是面向链接的

spi参数：安全参数索引，加密秘钥，认证秘钥。加密算法标识

序列号，抗重播窗口，生存周期，运行模式，ipsec隧道源，目的地址

安



ipsec数据报

在ip头部加一个ah头

esp是在ip数据报尾部加一个esp尾，数据载荷之前加一个esp头

最后加一个认证数据

隧道模式esp

新ip头，esp头 源ip头源ip数据报，源ip数据报载荷，esp尾部，esp认证



将源ip数据报转换

检索spd，确定处理策略

检索sap，确定sa

在原ip数据报后面附加esp尾部

利用sa定义的算法与秘钥，加密上述写结果

在加密结果前面附加esp头部，穿件enchilada

针对整个enchilada，利用sa定义的算法与秘钥，创建文认证码mac

在enchilada后面附加mac，构成载荷（新ip数据报载荷）

构造全新ip头，包含所有经典的ipv4首部字段

将新ip头附加在载荷前面



ipsec支持两种方式

手工，自动

ike协议可自动管理sa的建立，协商，修改和删除，是ip唯一的秘钥管理

ike包括两个阶段：

阶段1：建立双向ike sa，为双方进一步的ikp提供通信机密性，数据完整性



阶段2：基于isakmp协议，进行ip sa安全协商



#### 无线局域网加密

wep：有线等效保密

对称秘钥加密

自同步

高效

流密码

wep漏洞：

每个帧最终会被重用

iv以明文传出-》重用iv容易被检测



 802.11i

多种（更强的）可选的加密方法

提供秘钥分发

利用独立于ap的认证服务器

ieee802.11i服务

认证

访问控制

数据完整性加密

运行的4个阶段



防火墙：内部网络与外部网络的隔离

预防拒绝服务攻击

预防非法修改/内部数据访问

只允许对内部网络的授权访问

三种类型的防火强

​        无状态分组过滤器

​        有状态分组过滤器

​         应用网关

无状态分组实现：访问控制链表，笨拙

有状态分组过滤：跟踪某干tcp链接

进行选择链接，或者断开无效某个链接



应用网关：基于应用层的数据一斤ip/tcp/udp头部字段进行过滤

1要求所有Telnet用户公国网关Telnet外部网络

2.对于授权的用户，网关代理用户与目的的主机建立Telnet链接

并且在两个链接之间进行数据中继

3.路由器阻止所有不是网关发起的telnet链接

局限性：

ip欺骗

如果多个应用需要特殊处理，则每个应用需要一个应用网关

客户软件必须知道如何链接网关

过滤器经常对udp流量使用“全部通过”或者“全部不通过”策略

折中：确定安全级别

很多安全防护级别很高的网站仍然遭受攻击

