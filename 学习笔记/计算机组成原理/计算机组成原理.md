# 计算机组成原理

## 课程概貌

讲授内容

基本不见的结构和组织方式

基本运算的操作系统

基本部件和单元的设计思想

### 课程的分割整合

计算机组成原理之机器

1. 计算机系统的基本概念
2. 总线
3. 存储器
4. 输入输出系统

计算机组成原理至数字

1. 计算机中数的表示
2. 计算机的运算方法和运算器

计算机的组成原理之cpu

1. 指令系统
2. cpu的结构和功能
3. 控制单元
4. 控制单元的设计

  指令的引入是，分析加测评

## 计算机组成原理-硬件

## 第一章　概论

### 1.1，计算机系统简介

现代计算机系统的多态性

#### 1，计算机系统

  硬件： 计算机的实体，如主机，外设

  软件：由具有各类型特殊功能的信息组成

> 系统软件 用来管理整个计算机系统
>
> ​                   语言处理程序
>
> ​                   操作系统
>
> ​                   服务型程序
>
> ​                    数据库管理系统
>
> ​                     网络软件

> 应用软件      按任务需要编制成的各种程序

#### 2，计算机系统的层次结构

系统复杂性管理的方法1

抽象-指高级的模型，和低级的实体相对

​         隐藏系统中不必要的细节





高级语言

汇编语言 

操作系统

机器语言 

微指令系统

程序员角度：

虚拟机器m4       用程序翻译成汇编语言

|

虚拟机器m3       翻译成机器语言

|

虚拟机器m2       用机器语言解释成操作系统         软件

|                                                                                    |

实际机器m1       用微指令解释机器指令                  硬件

|

微程序机器m0     有硬件直接执行微指令

计算机体系结构：程序员所见到的计算机系统属性

​                               概念性结构与功能特性

计算机组成：实现计算机体系结构所体现的属性

​                       （具体指令的实现）



### 1.2，计算机的基本结构

1，冯诺依曼计算机特点

edvac（缩写）

1. 控制器-运算器-存储器-输出设备-出入设备
2. 指令和数据以同等地位存于存储器，可按地址寻访
3. 指令和数据用二进制表示
4. 指令由操作码和地址码组成
5. 存储器
6. 以运算器为中心

2，计算机硬件框图

1. 以存储器位中心的计算机硬件框图

2. 现在计算机硬件框图

   运算器   alu       cpu

   控制器     cu       cpu       主机            

   存储器      主存                 主机            硬件

   ​                   辅存

   输入设备          i/0设备       i/o              硬件  

   输出设备          i/o设备

* 系统复杂性管理的方法

   -层次化：将被设计的系统划分为多个模块或子模块

   -模块化：有明确定义的功能和接口

   -规则化：模块更加容易被重用



计算机解决的问题：

一个现实的问题，如何利用计算机来解决？

1. 上机前准备
   * 建立数学模型
   * 确定计算方法
   * 编制解题程序



​         指令分为操作码和地址码

​         数据也保存在存储器中

​         1。存储器的基本组成

​                存储体-存储单元-存储元件

​                存储单元：存放一串二进制代码

​                存储字：存储单元中二进制代码的组合

​                存储长度：存储单元中二进制代码的数，每个存储单元赋予了一个地址

​                按地址寻访

​                 存储器的基本组成

​                            mar存储器地址寄存器反映存储单元的个数

​                             mdr存储器数据寄存器反映存储字长

​            2。运算器的结构？x alu acc mq

​           3。控制器的结构如何呢？

​                   功能：解释指令，保证指令的按序执行

​                    完成一条指令: 取指令pc，分析指令ir，执行指令cu

​                指令：取数指令，存数指令

​             5。ax^2+bx+c程序的运行过程

​                  将程序通过输入设备送至计算机

​                  程序首地址-》pc

​                  启动程序运行

​                  取地址pc-mar-m-mdr-ir，（pc）+1-  pc

​                  分析指令  op（ir）-cu

​                  执行指令  ad（ir）-mar-m-mdr-acc

​                   。。。

​                   打印结果

​                   停机

### 1.3，计算机硬件的主要技术指标

1. 机器字长
2. 运算速度   （主频，核数，吉布森法 cpi 执行一条指令需要的时钟周期，mips 每秒执行的命令多少，每秒完成了多少浮点运算）
3. 存储容量（主存容量<存储单元个数×存储字长，字节数>，辅存容量）

## 第二章　计算机发展史

### 2.1，计算机发展史

1. 计算机的产生 第一太计算器neinc

   计算机的驱动力：需求，技术发展，

   1代 电子管，二晶体管，三中小规模集成电路，四，大规模集成电路， 5超大规模集成短路

2. 微型计算机的出现和发展

3. 软件技术的兴起和发展

    1各种语言

   ​     机器语言 面向机器

   ​     汇编语言 面向机器

   ​     高级语言 面向问题

   2 系统软件

​       语言处理程序， 汇编程序，编译程序，解释程序

   ​    操作系统，

   ​    服务性程序

   ​    数据库管理系统

   ​    网络软件

   3 软件发展特点

      （1）开发周期长
    
      （2）制作成本高昂
    
      （3）检测软件产品质量的特殊性

​              软件是程序以及开发，使用，和维护程序所需要的所有文档

### 2.2，计算机的应用

一，科学计算和数据处理

二，工业控制和实时控制

三，网络技术

​        1，电子商务

​        2，网络教育

​        3，敏捷制造

四，虚拟现实

​          1.飞行训练机

五，办公自动化和管理信息系统

六，cad/cam/cims

七，多媒体技术

八，人工智能

### 2.3，计算机的展望

一，计算机具有类似人脑的一些超级智能功能

二，芯片集成度的提高限制

​      芯片集成度受物理极限制约

​      按集合结束递增的制作成本

​      芯片的功耗，散热，线延迟

三 ？替代传统的硅芯片

​          1，光计算机

​                 利用光子取代电子进行运算和存储

​          2，DNA生物计算

​                通过控制DNA分子间的生化反应

​          3，量子计算机

​                利用原子所具有的量子特性

## 第三章 系统总线

### 3.1，总线的基本分类

一，为啥要用总线

二，什么是总线

　　　　总线是链接各个部件的信息传输线

　　　　是各个部件共享的传输介质

三，总线上信息的传送

　　　　串行

　　　　并行

四，总线结构的计算机举例

　　　１，单总线结构框图

　　　２，面向ｃｐｕ的双总线结构框图

　　　３，以存储器为中心的双总线结构框图

### 3.2，总线的分类

１，片内总线，　芯片内部的总线

２，系统总线　计算机各个部件之间的信息传输总线

　　数据总线　双向与机器字长，存储器字长有关

　　地址总线　单向　与存储器地址，ｉ/o地址有关

　　控制总线　　有出（存储器的读，写）　　有入（中断）

３，通信总线

　　用于计算机系统之间或计算机系统与其他系统（如控制仪表，移动通信等）之间的通信

　　　　　　　　｜串行通信总线

　　传输方式　　｜并行通信总线

### 3.3，总线特性及性能指标

一，总线物理实现

二，总线特性

　　１，机械特性　尺寸，形状，管脚数　排列顺序

　　２，电气特性　传输方向和有效的电平范围

　　３，功能特性　每根传输线的功能（地址，数据，控制）

　　４，时间特性　信号的时序关系

三，总线的性能指标

　　１总线的宽度

　　２，标准传输率

　　３，时钟同步，异步

　　４，总线服用　地址线与数据线服用（减少管脚数）

　　５，信号线数　地址，数据，控制，总和

　　６，总线控制方式　突发，自动，仲裁，逻辑，计数

　　７，其他指标

四，总线标准

　　模块　标准界面

　　系统　　　

### 3.4，总线结构

一，单总线结构

二，多总线结构

　　１，双总线结构

　　２，三总线结构　ｉ/o总线　主存总线　ｄｍａ总线

　　３，三总线结构又一形式　局部总线，系统总线，扩展总线

　　４，四总线结构　局部总线，系统总线，告诉总线，扩展总线

三，总线结构举例

　　１，传统微型机总线结构

　　２，ＶＬ－ＢＵＳ局部总线结构

　　３，ＰＣＩ总线结构

　　４，多层ＰＣＩ总线结构

### 3.5，总线控制

一，总线的判优控制

　　１，基本概念

　　　　主模块　对总线有控制权

　　　　从模块　响应从主设备发来的总线命令

　　　　　　　　　　　　　　　　　｜链式查询

　　　　　　　　　　　｜集中式　　｜计数器定时查询

　　　　　　　　　　　　　　　　　｜独立请求方式

　　　　总线判优控制　｜分布式

　　２，链式查询

　　　　ＢＳ－总先忙

　　　　ＢＲ－总线请求

　　　　ＢＧ—总线允许

　　３，计数器定时查询

　　　　ＢＳ－同上

　　　　ＢＲ－同上

　　３，独立请求方式

　　　　ＢＧ

　　　　ＢＲ

二，总线通信控制

　　１，目的　解决通信双方　协调配合

　　２，总线传输周期

　　　　申请分配阶段　主模块申请，总线仲裁决定

　　　　寻址　　　　　主模块向从模块给出地址　和命令

　　　　传数阶段　　　主模块和从模块交换数据

　　　　结束阶段　　　主模块撤销有关消息

　　３，总线通信的四种方式

　　　　同步通信　由统一时标控制数据传输

　　　　异步通信　采用应答方式，没有公共时钟标准

　　　　半同步通信　同步，异步结合

　　　　分离式通信　充分挖掘　系统　总线每个瞬间的潜能

　　　　（１）同步式数据输入，固定时间点给出相应操作

　　　　（２）同步式数据输出　固定的时间给出固定的操作

　　　　　　　　用最慢的时间标识，来作为标识

　　　　（３）异步通信　　请求　回答

　　　　　　　　　不互锁，　半互锁　　全互锁

　　　　（４）半同步通信（同步，异步结合）

　　　　　　　同步　发送方用系统　时钟前沿发信号

　　　　　　　　　　接受方用系统时钟后沿判断，识别

　　　　　　　异步　允许不同速度的模块和谐工作

　　　　　　　　　　增加一天“等待”相应信号

　　　　　　以输入数据为例的半同步通信时序

　　　　　　　Ｔ１，主模块发地址

　　　　　　　Ｔ２，主模块发命令

　　　　　　　Ｔｗ　当ｗａｉｔ为低电平时，等待一个ｔ

　　　　　　　。。

　　　　　　　Ｔ３　从模块提供数据

　　　　　　　Ｔ４　从模块撤销数据，主模块撤销命令

　　　　　（４）半同步信号（同步，异步结合）

　　　以上三种通信的共同特点

　　　　　一个总线传输周期（以输入数据位例）

　　　　　主模块发地址，命令　占用总线

　　　　　从地址准备数据　　不占用总线　总线空闲

　　　　　从模块向主模块发数据　占用总线

　　　　　（５）分离式通信　

　　　　　　　　充分挖掘总线每个瞬间的潜力

　　　　　　　　一个中线传输周期

　　　　　　　　｜子周期１　主模块申请　占用总线，使用完成

　　　　　　　　　　　　　　后放即放弃中线的使用权

　　　　　　　　｜子周期２　从模块申请占用总线，将各种信号送

　　　　　　　　　　　　　　至总线上

　　　　　　　　分离式通信特点：

　　　　　　　　　　　　１．各模块有权申请占用总线

　　　　　　　　　　　　２．采用同步方式通信，不等对方回答

　　　　　　　　　　　　３．各模块准备数据时，不占用总线

　　　　　　　　　　　　４．总线被占用时，无空闲

## 第四章　存储器

### 4.1，概述

　　存储器类型？

​       现代存储器的层次结构，为什么要分层？

一，存储器的分类

　　１，按存储器介质分类

　　　　（１）半导体，　　TTL，MOS　　　　　　易失

　　　　（２）磁表面存储器 磁头，载磁体　　　　　非易失

　　　　（３）磁芯存储器　硬磁材料　环状原件　　非易失

　　　　（４）光盘存储器　激光，磁光材料　　　　非易失

　　２，按存取方式分类

　　　（１）存取时间与物理地址无关（随机访问）

　　　　　　　随机存储器　在程序执行过程中可读可写

　　　　　　　只读存储器　在程序的执行过程中　只读

　　　（２）存取时间与物理地址有关（串行访问）

　　　　　　　顺序存储器　　　磁带

　　　　　　　直接存取存储器　磁盘

　　３，按在计算机中的作用分类

　　　　　　　　　　　　　　　　静态ＲＡＭ
　　　　　　　　　　　　　RAM　动态ＲＡＭ

​                            主存储器　　

　　　　　　　　　　　　　　　　MROM
　　　　　　　　　　　　　　　　ＰROM

　　　　　　　　　　　　　ROM   EPROM

​                                                             EEPROM

　　　　存储器 Flash Memory

　　　　　　　高速缓存存储器（ｃａｓｈｅ）

​                            辅助存储器（磁盘，磁带，光盘）

二，存储器的层次结构

　　１，存储器的主要特性的关系

　　　　　速度　容量，价格/位

​              (存储体系)

　　　　寄存器，缓存，主存，磁盘，光盘，磁带

　　　　（软件硬件相结合，程序员不用关心存储在哪）

　　２，存储－主存层次和主存－辅存层次

　　　　缓存－主存（硬件）　主存－辅存（软硬件结合）　

　　　

### 4.2，主存储器

一，概述

　１，基本组成

　２，主存和ｃｐｕ关系（总线相连）

　３，主存中存储单元地址分配

　　　高位字节地址位字地址

　　　低位字节地址为字地址

　４，主存的技术指标

　　　（１）存储容量　主存　存放二进制代码总位数

　　　（２）存储速度

　　　　　　　存取时间　存储器的访问时间　读取时间　写入时间

　　　　　　　存取周期　连续两次独立的存储器操作（读或写）所需的最小间隔时间

　　　　　　　　　　　　读周期　写周期

　　　（３）存储带宽

二，半导体芯片简介

１，半导体存储结构

　　地址线，片选线，读写控制线，数据线

２，半导体存储芯片的译码驱动方式

　　（１）线选法

　　　　　　地址译码器，　读写控制电路

　　（２）重合法

　　　　　　ｘ地址译码器，ｙ地址译码器，　读写控制

三，随机存取存储器（ｒａｍ）

　　１，静态ｒａｍ

　　　　保存０和１的原理是什么？

　　　　　开关，熔丝？

　　　　　用的是触发器？（４个管子）

　　　　基本单元电路的构成？

　　　　对单元电路如何读出和写入？

　　　　典型芯片的结构是什么样子的？

　　　　静态ｒａｍ芯片的如何进行读出和写入操作？

　　２，动态ＲＡＭ

　　３，动态RＡＭ和静态ＲＡＭ的比较

四，只读存储器（ｒｏｍ）

　　保存系统程序和系统的配置信息

　　　> 最早的只读存储器－－在厂家就写好了内容
　　　>
　　　> 改进１－－用户可以自己写－一次性
　　　>
　　　> 改进２－－可以多次写－－要能对信息进行擦除
　　　>
　　　> 改进３－－电可擦写－－特定设备
　　　>
　　　> 改进４－－电可擦写－－直接链接到计算机

１，掩模ＲＯＭ

​     　行列选择线交叉处有MOS管为“１“

　　行列选择线交叉处无ＭＯＳ管位”０“

２，ＰＲＯＭ（一次性编程）

３，ＥＰＲＯＭ（多次性编程）（紫外线可擦除）

４，EEＰＲＯＭ（多次性编程）

　　电可擦写，局部可擦写，全部可擦写

５，Ｆｌａｓｈ　Ｍｅｍｏｒｙ（闪速型存储器）

　　ＥＰＥＯＭ　　　价格便宜　集成度高

　 　ＥＥＰＲＯＭ　电可擦洗重写	

　　比ＲＲＰＲＯＭ快　具备ＲＭＡ功能

五，存储器与ｃｐｕ的链接

１，存储器容量的扩展

　　（１）位扩展（增加存储字长）（并联）（把一个芯片当一个来用）

　　（２）字扩张（增加容量）（串联）（增加一个片选）

　　（３）字，位扩展

２，内存和ｃｕｐ的链接

　　（１）地址线的链接

　　（２）数据线的链接

　　（３）控制线读/写的链接

　　（４）片选线的链接

　　（５）合理的选择存储芯片

　　（６）其他　　时序　负载

例题：（１）写出对应的二进制地址码

　　　（２）确定芯片的数量以及类型

　　　（３）分配地址线

　　　（４）确定片选信号

六，存储器的校验

​	１，为什么要对存储器的信息进行校验

　　２，为了能够校验出信息是否正确，如何进行编码

　　３，纠错或检错能力与生么有关

　　４，校验出信息出错后是如何进行纠错的

　　５，除了我们教材将的校验码，你还知道那些容错编码，原理是生么



合法代码集合

　　１，｛０００，００１，，，，１１１｝检０位错，纠０位错

　　２，｛０００，０１１，１０１，１１０｝检１位错，纠０位错

　　３，｛０００，１１１｝检１位错，纠１位错

　　４，｛００００，１１１１｝检２位错，纠１位错

　　５，｛０００００，１１１１１｝检２位错，纠２位错

　　编码的检测能力和纠错能力和什么有关？

　　任意两个合法代码之间二进制位的最小差异数

１，编码的最小距离

　　　任意两组合法代码之间二进制位数的最小差异编码的纠错，检错能力与编码的最小距离

　　L-1-=D+C(D>=C)

　　Ｌ－－编码的最小距离　L=3

　　Ｄ－－检测错误的位数　具有一位纠错能力

　　Ｃ－－纠正错误的位数

２，汗明码的组成

　　汉明码采用奇偶检验

　　汉明码采用分组校验

　　汉明码的分组是一种非划分方式

　　分成３组，每组有１位校验位，工包括４位数据位

　　组成汉明码的三要素

　　哈明码的组成需增添？位检测位

　　检测位的位置

　　检测位的取值

　　　检测为的取值与该位所在的检测”小组“承担的奇偶校验任务有关

例题：求０１０１按偶校验配置汉明码

　　　ｎ＝４

　　　　２^K>=n + k + 1

​                    k=3

汉明码排序如下：

二进制序号：　１　２　３　４　５　６　７

名称　　　　　ｃ１ｃ２０　ｃ４１　０　１

　　　　　　　０　１　　　　０

３，汉明码的纠错过程

０１００１１１

ｐ１＝１亦或３　　５　　７＝０　无错

ｐ２＝２　　３　　６　　７＝１　有错

ｐ４＝４　　５　　６　　７＝１　有错

第六位错了

校验位错了可以不用纠错

七，提高存取速度的措施

采用高速器件

采用层次结构ｃａｃｈｅ—主存

调整主存结构

１，单体多字系统

增加存储器的带宽

２，多体并行系统

（１）高位交叉，顺序编址

（２）地位交叉　各个题轮流编址

低位交叉的特点（ｃｕｐ速度大于内存的，所以可以在一个周期内给多个存储器发送命令）

　　不改变存取周期的前提下，增加存储器的带宽

３，高性能存储芯片

　（１）SDRAM(同步ＤＲＡＭ)

　　　在系统时钟的控制下进行读出和写入

　　　ｃｐｕ无须等待

　（２）ＲＤＲＡＭ

　　　　主要解决存储器带宽问题

　（３）带ＣＡＣＨＥ的DRＡＭ

　　　在ＤＲＡＭ的芯片内集成了一个由ＳＲＡＭ组成的ｃａｃｈｅ，有利用猝发式读取

### 4.3，高速缓存存储器

* 一概述

  １，为什么用ｃａｃｈｅ

  　　避免ｃｐｕ“空等”现象

  　　ｃｐｕ个主存（ｄｒａｍ）的速度差异

  　　程序局部性访问原理

  ２，ｃａｃｈｅ的工作原理

  　　主存和缓存的编址（主存和缓存按块存储，块的大小相同）

  

  　　命中与未命中

  　　　主存大于缓存，

  　　　主存块与缓存块建立了对应关系

  　　　用标记记录与某缓存块建立了对应关系的主存块号

  　　　未命中　主存块　未调入

  　　　　　　　主存快与缓存块　未建立　对应关系

  

  　　ｃａｃｈｅ的命中率

  　　　ｃｐｕ欲访问的信息字ｃａｃｈｅ中的比率

  　　　命中率与ｃｈｃｈｅ的容量与块长有关

  　　　块长取一个存取周期内从主存调出信息的长度

  

  　　ｃａｃｈｅ主存系统的效率

  　　　ｅ=访问ｃａｈｃｈｅ的时间/平均访问时间　×１００％

  ３，ｃａｃｈｅ的基本结构

  　　主存的替换和映射　,cache存储体，

  

  ４，ｃａｃｈｅ的读写操作

  　　读　ｘｘ

  　　写　ｃａｃｈｅ和主存的一致性

  　　　　写直达法（即写ｃａｃｈｅ又写内存）

  　　　　写回法(写ｃａｃｈｅ)

  

  ５，ｃａｃｈｅ的改进

　　　　增加ｃａｃｈｅ的级数

　　　　　　片内ｃａｃｈｅ

　　　　　　片外ｃａｃｈｅ

　　　　统一缓存和分立缓存

　　　　　　指令ｃａｃｈｅ　数据ｃａｃｈｅ

* 二，cache 主存的地址映射

　　　１，直接映射（主存块和ｃａｃｈｅ块大小相同）

　　　　　每个缓存块可以和若干个主存块对应

　　　　　每个主存块智能和一个缓存块对应

　　　２，全相联模式（任何一个主存块可被映射到任意一个擦车

中）　　　问题：需要查看每个标记块

　　　３，组相连映射（ｃａｃｈｅ被分成若干组，每组ｃａｃｈｅ内块可以放置内存组中的任意块）

　　　　结构较位简单，不复杂，速度快

* 三，替换算法

　　　１，先进先出（FILO）算法

　　　２，近期使用最少算法（ＬＲＵ）算法

### 4.4，辅助存储器

* 一，概述

  　　１，特点，不直接与ｃｐｕ交换信息

  　　２，磁表面存储技术指标

  　　　　１，记录密度　２，存储容量　３，平均寻址时间，　４数据传输率　５，误码率

* 二，磁记录原理

  　　写：读：

* 三，硬盘存储器

　　　　１，硬磁盘存储器类型

　　　　　　（１）固定磁头和移动磁头

　　　　　　（２）可换盘和固定盘

　　　　２，硬磁盘存储器结构

　　　　３，磁盘控制器

　　　　　　接收主机发来的命令，转换成磁盘驱动器的控制命令

　　　　　　实现格式转换，控制磁盘的读写，

　　　　４，盘片　铝合金

* 四，软盘存储器
* 五，光盘存储器

　　　　采用光存储技术　利用激光写入和读出

　　　　第一代不可擦写

　　　　第二带不可擦写

##　第五章　输入输出系统

###　5.1，概述

一，输入输出系统的发展

　　１，早起

　　　　分散链接

　　　　ｃｐｕ和ｉ/o设备　串行工作　程序查询方式

　　２，借口模块和ｄｍａ阶段

　　　　总线链接　　　　　　　　　　｜终端方式

　　　　ｃｐｕ和ｉ/ｏ设备　并行工作　｜ｄｍａ方式

　　３，具有通道结构的阶段

　　４，具有ｉ/o处理机的阶段

二，输入输出系统的组成

　　１，ｉ/ｏ软件

　　　　（１）ｉ/o指令　ｃｐｕ指令的一部分

　　　　　　　　　操作码　命令码　设备码

　　　　（２）通道指令　通道自身的指令

　　　　　　　指出数组的首地址，传送字数，操作命令

　　　　　　　如ｉｂｍ/３７０通道指令为６４位

　　２，硬件

　　　　设备　　i/o接口

　　　　设备　　设备控制器　　通道

三，ｉ/o设备与主机的联系方式

　　１．ｉ/o设备编制方式

　　　（１）统一编址　取数，存数指令	

　　　（２）不统一编址　有专门的i/o指令

　　２，设备选址

　　　　用设备选择电路识别是否被选中

　　３，传送方式

　　　　１，串行

　　　　２，并行

　　４，联络方式

　　　　１，立即响应

　　　　２，异步工作采用应答信号

　　并行：

　　串行：

　　　　３，同步工作采用同步时标

　　５，i/o设备与主机的链接方式

　　　　１，辐射式链接

　　　　２，总线链接

四，i/o设备与主机信息传送的控制方式

　　１，程序查询方式

　　　　ｃｐｕ一手拖两家，ｃｐｕ原地踏步等待设备接入



　　２，程序中断方式

　　　　　　　　　　｜自身准备　　　　ｃpu不查询

　　　　i/o设备工作　｜与主机交换信息　ｃｐｕ暂停现行程序

　　　　没哟踏步等待现象，中断现行程序

　　　　ｃｐｕ和ｉ/o部分的并行工作

　　　　需要ｃｐｕ保护现场



　　３，ｄｍａ方式

　　　　主存和i/o之间有一条数据通道

　　　　不中断现行程序

　　　　周期挪用（周期窃取）

　　　　ｃｐｕ和ｉ/o并行工作

### 5.2，外部设备

一，概述

　设备控制器，机，电，磁，光

　外部设备大致分为三类

　１，人机交互设备　　键盘，鼠标，打印机，显示器

　２，计算机信息存储设备　磁盘，光盘，磁带

　２，机－机通信设备　调制解调器等

二，输入设备

　　１，键盘

　　　　按键

　　　　判断那个键按下

　　　　将此键翻译成ａｓｃＩＩ码（编码键盘法）

　　　　方式：中断方式

　　２，鼠标

　　　　机械式　金属球　电位器

　　　　光电式　光电转换器

　　３，触摸屏

三，输出设备

　　１，显示器

　　　　１，字符显示　字符发生器

　　　　２，图形显示　主管图像

　　　　３，图像显示　客观图像

　　２，打印机

　　　　１，打击式　　点阵式（逐字，逐行）

　　　　２，非打击式　激光（逐页）喷墨（逐页）

四，其他

　　１，A/D D/A　模拟/数字　转换器

　　２，终端　由键盘和显示器组成

　　　　完成显示控制与存储，键盘管理及通信控制

　　３，汉字处理　汉字输入，汉字存储，汉字输出



五，多媒体技术

　　１，生命是对媒体技术

　　２，多媒体计算机的关键技术　

###　5.3，i/o接口

一，概述

　　为什么要设置接口？

　　１，实现设备的选择

　　２，实现数据缓冲到达速递匹配

　　３，实现数据串－并格式转换

　　４，实现点平转换

　　５，传送控制命令

　　６，反映设备状态（“忙”，“就绪”，“中断请求”）

二，接口的功能和组成

　　１，总线链接范式的i/o接口电路

　　　　１，设备选择线

　　　　２，数据线

　　　　３，命令线

　　　　４，状态线

　　２，接口的功能和组成

| 功能               | 组成                   |
| ------------------ | ---------------------- |
| 选址功能           | 设备选择电路           |
| 传送命令的功能     | 命令寄存器，命令译码器 |
| 传送数据的功能     | 数据缓存寄存器         |
| 反映设备状态的功能 | 设备状态标记           |

　　　完成触发器Ｄ

　　　工作触发器Ｂ

　　　终端请求触发器INTR

　　　屏蔽触发器ＭＡＳＫ

　　　选址功能，传送命令的功能，传送

　　３，i/o接口的基本组成

　　

三，接口类型

　　１，按照数据传送方式分类

　　　　并行接口，串行接口

　　２，按功能选择的灵活性分类

　　　　可编程接口　不可编程接口

　　３，按照通用性分类

　　　　通用接口，专用接口

　　４，按数据传送的控制方式分类

　　　　中断接口，ｄｍａ接口

### 5.4，程序查询方式

一，程序查询方式的流程

　　　１，查询流程

　　　　　单个设备，　多个设备（优先级，）

　　　２，程序流程

　　　　　保存寄存器内容，设置计数器值（ｎ 或-n）设置主存缓冲区首地址

　　　３，

二，程序查询方式的接口电路

　　设备选择电路，ｘｘｘ

### 5.5，程序中断方式

一，中断的概念

　　　程序在执行程序的时候，出现特殊情况，转而需要取执行其他程序的过程

二，i/o中断的产生

　　以打印机为例

三，程序中断方式的接口电路

　　１，配置中断请求触发器和终端屏蔽触发器

　　２，排队器

　　　　排队　｜硬件　在ｃｐｕ内或在接口电路中（链式排队器）（最后那个１优先级的最高）

　　　　　　　｜软件　见第八章

　　３，中断向量地址形成部件

　　　　入口地址：｜由软件禅城　见：第八章

　　　　　　　　　｜硬件向量法　由硬件产生向量地址，再由向量地址找到入口地址

　　　　　中断向量地址形成部件（设备编码器）

　　４，程序中断方式接口电路的基本组成

　　　一共５部分：设备选择电路，ｘｘｘ

四，i/o中断处理过程

１，ｃｐｕ响应冲断的条件和时间

　　　１，条件

　　　　　允许中断触发器ＥＩＮＴ＝１

 　　　　　用开关指令将ＥＩＮＴ置　“１”

　　　　　用关中断指令将ＥＩＮＴ置“０”　或硬件自动回复

　　　２，时间

　　　　　当Ｄ＝１且mask＝０时

　　　　　在每条指令执行阶段的结束前

　　　　　ｃｐｕ发总段查询信号

２，ｉ/ｏ中断处理过程

　　出入读指令　ｃｐｕ发地址，设备选择，启动命令，设备开始工作，工作结束，输入数据　设备空闲，等待ｃｐｕ读取　进入排队器，等待，转换位地址

五，中断服务程序流程

１，总段服务程序的流程

　　１，保护现场

　　　程序端点的保护　中断隐指令完成

　　　寄存器内容的保护　进栈指令

　　２，中断服务

　　　　付不同的i/o设备具有不同内容的设备服务

　　３，恢复现场　　出栈指令

　　４，中断返回　

２，单重总断和多重总断

　　单重中断　不允许总断现行的总断服务程序

　　多重中断　允许级别更高的中断源总断现行的中断服务程序　

3，单重中断和多重中断的服务程序流程



４主程序和服务程序抢占ｃｐｕ示意图

### 5.6，ＤＭＡ方式

１．ｄｍａ和程序中断两种方式的数据通路

２，ｄｍａ和主存交换数据的三证方式

　　１，停止ｃｐｕ访问主存

　　　　控制简单

　　　　ｃｐｕ处于不工作状态或保持状态

　　　　未充分发挥ｃｐｕ对主存的利用率

　　２，周期挪用（或周期窃取）

　　　　ｄｍａ访问主存有三种可能

　　　　ｃｐｕ此时不访问

　　　　ｃｐｕ正在方寸

　　　　ｃｐｕ与ｄｍａ同事请求访存

　　　　此时ｃｐｕ将总线控制权让给ｄｍａ

　　３，ｄｍａ与ｃｐｕ交替访问

　　　　ｃｐｕ工作周期　｜ｃ１专供ｄｍａ访存

　　　　　　　　　　　　｜ｃ２专供ｃｐｕ访存

二，dma接口的功能和组成

　　１，ｄｍａ接口功能

　　　　１，向ｃｐｕ申请ｄｍａ传送

　　　　２，处理总线控制权的转交

　　　　３，管理系统总线，控制数据传送

　　　　４，确定数据传送的首地址和长度

　　　　　　修正传送过程中的数据地址和长度

　　　　５，ｄｍａ传送结束时，给出操作完成信号

　　２，ｄｍａ接口组成

　　　　

三，ｄｍａ的工作过程

　　１，ｄｍａ传送过程

　　　　预处理，数据传送，后处理

　　　（１）预处理

　　　　　通过几条输入输出指令预置如下信息

　　　　　　　通知ｄｍａ控制逻辑传送如下信息

　　　　　　　设备地址－》ｄｍａ的ｄａｒ

　　　　　　　主存地址－》ｄｍａ的ａｒ

　　　　（２）ｄｍａ传送过程示意图

　　　　（３）数据传送过程（输入）

　　　　（４）数据传送过程（输出）

　　　　（５）后处理

　　　　　　　检验送入主存的数是否正确

　　　　　　　是否继续用ｄｍａ

　　　　　　　测试传送过程是否正确，错则转诊断程序

　　　　　　　由终端服务程序完成

　　　２，ｄｍａ接口与系统的链接方式

　　　　　（１）具有公共请求线的ｄｍａ请求

　　　　　（２）独立的ｄｍａ请求

　　　　　（３）ｄｍａ方式与程序总段方式的比较

| x            | 中断方式     | ｄｍａ方式   |
| ------------ | ------------ | ------------ |
| 数据传送     | 程序         | 硬件         |
| 响应时间     | 指令执行结束 | 存取周期结束 |
| 处理异常情况 | 能           | 不能         |
| 中断请求     | 传送数据     | 后处理       |
| 优先级       | 低           | 高           |



四，ｄｍａ接口类型

　　１，选择型，在物理上链接多个设备

　　　　　　　　在逻辑上只允许链接一个设备

　　２，多路型　在物理上链接多个设备

　　　　　　　在逻辑上允许链接多个设备同事工作

　　３，多路型ｄｍａ接口的工作原理









　　

## 计算机组成原理－数字

主要内容

　　１，计算机中的数的表示

　　２，计算机的运算方法

　　３，运算器的设计

## 第六章　计算机的运算方法

### 6.1，无符号数和有符号数

一，无符号数

　　寄存器的位数

　　反映无符号数的表示范围

二，有符号数

　　１．机器数与真值

​              真值　　　　　　机器数

　　　带符号的数　　　　符号数字化的数

　　２，源码表示法

　　　　带符号的绝对值表示

　　　　（２）举例　【ｘ】=1.0011  x= -0.0011

​     　原码标识法简单直观

| 要求 | 数１ | 数２ | 实际操作 | 结果符号 |
| ---- | ---- | ---- | -------- | -------- |
| 加法 | 正   | 正   | 加       | 正       |
| 加法 | 正   | 负   | 减       | 可正可负 |
| 加法 | 负   | 正   | 减       | 可正可负 |
| 加法 | 负   | 负   | 加       | 负       |

　　３，补码表示法

　　　　１，补的概念

​                   　时钟　　逆时针　　顺时针

　　　　　　　　　　减５和加７一样

　　　　　　计数器　４位　　１０１１－＞００００

　　　　　　１０１１－１０１１　１０１１＋０１０１

　　　　２，整数的补数即为其本身

　　　　３，补码的定义

　　　　　　整数　正数：０，ｘ　负数　２＾(n+1)+x(x < 0)

  　　　　　　x=-1011000　

​       　　小数的补码是ｍｏｄ2的

　　　　４，求补码的快捷方式

　　　　　　每位去反末位加一

　　　　５，[x]补＝１．０００１　原：-０．１１１１

　　４，反码表示法

　　　　１，定义，就取反

　　　　　【＋０】反　！＝【－０】反

三种机器数的小结

　　最高位为符号位，书写上用“，”或“.”将数值部分和符号位隔开

　　对于正数，源码＝补码＝反码

　　对于负数，符号位为１，其数值部分源码除符号位每位取反末位加１－》补码

　　源码除符号位外每位取反－》反码

　　５，移码表示法

　　　　补码表示很难直接判断其值大小

　　　　ｘ+2^N

​     　　　（１）移码定义

### 6.2，数的定点表示和浮点表示

一，定点表示

　　小数点按约定方式标出

　　定点机　小数定点机　　　　　　　　　　　　　　正数定点机

　　源码　－（１－２＾（－ｎ））～+（１－２＾ｎ）

　　补码　－１～＝（１－２＾（－ｎ））

　　反码

二，浮点表示

　为什么在计算机中要引入浮点数表示？

　浮点表示的格式是什么

　尾数和阶码的基值必须是２吗？　基值的影响

　表数范围与精度和那些因素有关

　为什么要引入规格化表示

　目前浮点数表示格式的标准是什么

　ｎ=S\*r^j

　１．浮点数的表示形式

　　　阶符　阶码的数值部分　数符　尾符　尾数的数值部分

　２，浮点数的表示范围

　　阶符阶数位符位数

　３，浮点数的规格化形式

　　ｒ＝２　尾数最高位１

　　ｒ＝４　尾数最高位２不全位０

　　ｒ＝８　尾数最高３位不全位０

　４，浮点数规格化

　　ｒ＝２　左规　尾数左移一位，阶码减一

　　　　　　右规　尾数有移一位，阶码加一　

　　ｒ＝４　左规　尾数左移二位，阶码减一

　　　　　　右规　尾数有移二位，阶码加一

　　ｒ＝８　左规　尾数左移三位，阶码减一

　　　　　　右规　尾数有移三位，阶码加一

　　基数越大，浮点数的范文越低

　　基数越大，精度越低

三，举例

１９／128

 二进制形式：　　 ｘ＝０．００１００１１

定点表示：　　　　ｘ＝０．００１００１１０００

浮点规格化形式　    ｘ＝０．１００１１０００００＊２＾１０

定点机：　　　　　ｘ＝０．００１００１１０００

浮点机：　　　　　ｘ＝０．１００１１０００００

机器０

当浮点数尾数为０时，不论其阶码为何止按机器０处理

当浮点数解码等于或者小于它所表示的最小数时，不论尾数为何值，按机器零处理

当阶码和尾数都用补码表示时，机器零为

当阶码用移码，尾数用补码表示时，机器０

四，ieee７５４表示

ｓ　　阶码　尾数

数符

尾数为规格化表示

　　　　符号位　　阶码　　　尾数　总位数

短实数　１　　　８　　　　　２３　　３２

长实数　１　　　１１　　　　５２　　６４

临时实数　１　　１５　　　　６４　　８０

### 6.3，定点运算

一，移位运算

　１，移位意义　１５ｍ＝１５００ｃｍ

　　　机器用语　１５相对与小数点左移

　　　　　　　左移　绝对值

　　　　　　　右移　绝对值

　　在计算器中，移位与加减匹配，能够实现乘除

　２，算术移位规则

　　符号位不变

　　标准保持数值扩大或者缩小２倍

　３，算数移位的硬件实现

　　负数的源码　高位丢　低位补０

　　负数的补码　高位丢　低位补０

　　负数的反码　高位丢　低位补１

　　　　　　　正数    负数的源码   负数的补码 负数的反码　

《－丢一　　　出错　　　出错　　　正确　　不会

－》丢一　　　影响精度　影响精度　影响精度　不会

　４，算术移位和逻辑移位的区别

　　算术移位　有符号的移位

　　逻辑移位　无符号数移位

　　逻辑左移　地位添０，高位移丢

　　逻辑右移　高位添０，低位移丢　

二，加减法运算

　　１．补码加减法的运算公式

　　　（１）加法

　　　　　整数ａ＋ｂ

　　　（２）减法

　　　　　　ａ＋（－ｂ）

　　　连同符号位一起相加，符号位产生的进位自然丢掉

　　２，举例

　　３，溢出判断

　　　　１，一位符号位判断溢出

　　　　　　参加操作的两个数符号相同，其结果的符号与源操作数的符号不同，即为溢出

　　　　硬件实现

　　　　　　最高有效位的进位符号位的进位１

　　　（２）两位符号位判断溢出

　　４，补码加减法硬件配置

三，乘法运算

　　计算机中怎么做二进制的乘法运算呢？

　　　　可以分析一下笔算乘法是怎么做的

　　　　乘法竖式的符号心算求得

　　笔算乘法的分析

　　　乘法运算可以用加和和位移实现

　　　ｎ＝４　加４次

　　　有乘数的末位决定乘数是否与原部分积分相加

　　　然后－>1位形成新的部分积，同时乘数－》１位（末位移丢）

　　空出高位存放部分积的低位

　　　被乘数只与部分积的高位相加

　　　需要３个寄存器　其中两个具有位移功能

　　　１个全加器

　　４．源码乘法

　　　　（１）源码一位乘运算规则

　　　　　　乘积的符号位单独处理

　　　　　　数值部分为绝对值相乘

　　　　（２）源码一位乘递推公式

　　笔算乘法的改进

　　源码的乘法运算

　　　特点：　绝对值运算

　　　　　　　用移位的次数判断乘法是否结束

　　　　　　　逻辑移位

　　　　　Ａ低位数值部分

　　　　　　加法器　移位和加控制

　　　　　　控制器

　　补码的乘法运算

四，除法运算

　　笔算是怎么计算的？

　　如何利用计算机硬件来模拟笔算出发过程

　　回复余数发

　　加减交替发

　　１，分析笔算除法

　　　商符是心算获得的



　　笔算除法　　　　　　　机器除法

　　商符单独处理　　　　　符号位亦或形成

　　心算上商　　　　　　　大小比较　　　　　　

　　

　　余数不动低位补“０”　　　余数左移一位低位补“０”减除数

　　右移一位的除数　　　　　

　　　　　　　　　　　　　　１倍字长加法器

　　２倍字长加法器上商不固定　寄存器末位上商

　　３，原码除法

　　　　以小数为例

　　　　　　商的符号单独处理

　　　　约定　小数定点除法　ｘ《ｙ　整数定点除法

　　　　　　　被除数不等于０

　　　　　　　除数不能位０

　　　　（１）恢复余数发

　　　　　　移位后的余数

　　　　　　第一个上商溢出判断

　　　　（２）不恢复余数法

　　　　　　回复余数法运算规则

　　　　　　恢复余数除法运算规则

　　　　　　　余数》０　上商　“１”　２Ｒ－ｙ

　　　　　　　余数《０　上商　“０”　Ｒ＋ｙ×　　恢复余数

　　　　　　　２（ｒ＋ｙ\*）-　y*=2R + y\*

　　　　　　　不恢复余数法运算

　　　　（３）原码加法交替除法硬件配置

　　　　　　　　A　　　　　　　　左移

　　　　　　　ｎ＋１位加法器　　　移位和加控制逻辑

### 6.4，浮点四则运算

　　浮点数的加减法运算

　　　　－対阶　通过减法求阶差

　　　　ｘ－ｙ　　　　　　》０　ｘ向ｙ对齐　或者ｙ向ｘ看齐（又移误差小）

　　　　　　　　　　　　　《０　ｘ向ｙ对齐

　　　　　　原则：小的ｊ向大的ｊ对齐

　　　　－尾数求和

　　　　　　対阶后

　　　　　　尾数求和

　　　　－规格化

　　　　　　（１）规格化数的定义

　　　　　　　　　　ｒ＝２　

　　　　　　（２）规格化数的判断

　　　　　　　　　ｓ》０　规格化形式　　　　ｓ《　０　规格化形式

　　　　　　　　　真值，源码，补码，反码，　

　　　　　　　

　　　　　　　　　源码　不论正数，负数，第一位为１

　　　　　　　　　补码　符号位和第一数位不同

　　　　　　　（３）左规　尾数左移一位，阶码减一，直到数符和第一位不同为止

　　　　　　　（４）右规　当尾数溢出时，需右规

　　　　－溢出判断

　　　　－举例

　　浮点数的乘除法运算

　　４，舍入

　　　　在対阶和右规过程中，可能出现尾数末位丢失，引起的误差，需考虑舍入

　　　（１）０舍１入法

　　　  （２）恒置“１”法

　　５．溢出判断

　　　　设机器数为补码，尾数为规格化形式，并假设阶符取２位，阶码的数值部分取７位，数符取２位，尾数取ｎ位，则该补码在数轴上的表示为

###　６.5，算数逻辑单元

一，ALU电路　　　　Ａｉ　Ｖ　　Ｂｉ　　　组合逻辑电路

　　　　　　　　　　　　　Ｖ　　Ｋ　　　　ｋ不同取值

　　　　　　　　　　　　　Ｆ　　　　　　　Ｆ不同

　　　　　　　　　　四位　７４１８１

　　　　　　　　　　　Ｍ＝０　算数运算

　　　　　　　　　　　ｍ＝１　逻辑运算

　　　　　　　　　　ｓ３～ｓ０　不同取值，可做不同运算

二，快速进位链

　１，并行加法器（同步并行式）

　２，串行进位器

　　　　进位链　　　　传送进位的电路

　　　　串行进位链　　进位串行传送

　　　　以４位全加器为例　每一位的进位表达式为

　　　　　　　因为串行，所以有延迟

　３，并行进位链（先行进位，跳跃进位）

　　　（１）单重分组跳跃进位链

　　　　　　ｎ位全加器分若干组，小组中的进位同时产生

　　　　　　小组与小组之间采用串行进位

　　　（２）双重分组跳跃进位链

　　　　　　ｎ位全加器若干大组，大组中又包含若干小组。每个大组中的最好位进位同时产生，大组与大组之间采用串行进位

　　　（３）双重分组跳跃进位链，大组进位分析

　　　（４）双重分组跳跃进位链的小组进位线路

　　　（５）双重分组跳跃进位链的小组进位线路

　　　（６）ｎ＝１６双重分组跳跃进位链

　　　（７）ｎ＝３２双重分组跳跃进位链

##　计算机组成原理－ｃｐｕ

这部分我们将介绍什么

硬件与软件的接口：指令系统

控制单元：排队逻辑，寄存器和解码器，控制存储器

##　第七章　指令系统

指令系统在计算机系统中的地位

### 7.1，机器指令

* 指令的格式是什么？

　－操作码　地址码　寻址方式

 * 指令的字长

   固定字长，可变字长

一，指令的一般格式

　　　操作码字段　地址码字段

　　１，操作码　反映机器做什么操作

　　　　（１）长度固定

　　　　　　　用于指令字长较长的情况　RISC

　　　　　　　如ＩＢＭ　３７０

　    　　（２）长度可变

　　　　　　　操作码分散在不同的字段

　　　　（３）扩展操作码技术

　　　　　　　操作码的位数随地址数的减少而增加

　　　　　　　４位操作码　　　　最多１５条三地址指令　



　　　　　　　８位操作码　　　　最多１５条二地址指令

　　　　　　　１２位操作码　　　最多１５条一地址指令

　　　　　　　１６位操作码　　　１６条０地址指令

　　　　　　　三地址指令操作码没减少一种最多可以构成２＾４种地址指令

　　　　　　　二地址指令操作码每减少一种最多可构成２＾４种地址指令

　　　　　　　经常出现的用短操作码

　　２．地址码

　　　　（１）四地址

　　　　　　８　６　６　６　６

　　　　　ａ１第一操作数地址　　设指令子长位３２位

　　　　　ａ２第二操作数地址　　操作码固定位８位

　　　　　ａ３结果地址　４次访问

　　　　　ａ４下一跳指令地址　寻址范围　２＾６＝６４

　　　　　（Ａ１）ｏｐ（Ａ２）－》Ａ３

　　　　　　　ｐｃ代替ａ４

　　　　　（２）三地址　　４次访存

　　　　　　　　　　　　　寻址范围２＾８＝２５６

　　　　　　若Ａ３用ａ１或ａ２替代

　　　　　（３）二地址　　　　　　　４次访存

　　　　　　　８　１２　１２　　　　　　寻址范围２＾１２＝４Ｋ

　　　　　　　若结果存在与ＡＣＣ　３次访存

　　　　　（４）一地址　　　　　　　　　２　次访存

　　　　　　　（ＡＣＣ）ｏｐ（Ａ１）－》ＡＣＣ　

　　　　　　　　　　　　　　　　　　　　寻址范围　２＾２４＝１６Ｍ

　　　　　（５）０地址

　　　　　　　　没地址

　　　　　　　　对ａｃｃ操作

二，指令字长

　　　　　　　　　｜操作码的长度

指令字长决定与　　｜操作数地址长度

　　　　　　　　　｜操作数地址个数

１，指令字长　固定

　　　　指令字长＝存储字长

２，指令字长　可变

　　　　按字节的倍数变化

小结：

当用一些硬件资源代替指令字总的地址码字段后

　可以扩大指令的寻址范围

　可缩短指令字长

　可减少访存次数

当指令的地址字段位寄存器时

　三地址　ｏｐ

　二地址

　一地址

　可以缩短指令的字长

　指令执行过程不访问内存

### 7.2，操作数类型和操作类型

一，操作数类型

　地址　　无符号整数

　数字　　定点数　浮点数　１０禁止数

　字符　　ａｓｃｉｉ

　逻辑数　逻辑运算

二，数据在存储器中的存放方式

　　低地址存放，高地址存放

　　－字节编址，数据在存储器中的存放方式（存储字长６４位，机器字长３２位）

　　ａ从任意位置开始存储

　　优点：不浪费资源

　　缺点：除了访问一个字节之外，访问其他任何类型的编码都可能话费两个存储周期的时间，读写控制比较复杂

　　b从一个存储字的起始卫视开始访问

　　　优点：无论访问何种类型的数据，在一个周期均可完成，读写控制简单

　　　缺点：资源浪费了宝贵的存储资源

　　ｃ，边界对准方式－－从地址的整数倍位置开始访问

　　按照存放的起始地址是数据长度（按照进行计算）的整数倍

　　　本方案是前两个方案的折中，在一个周期可以完成存储访问，空间浪费不太严重

三，操作类型

　１，数据传送

　　　源　　　寄存器　　寄存器　　　存储器　　存储器

　　　目的　　寄存器　　存储器　　　寄存器　　存储器

　　　例如：　ｍｏｖ　ｓｔｏｒｅ　　ｌｏａｄ　ｍｏｖｅ

　　　　　　　　　　　　ｍｏｖｅ　　ｍｏｖｅ

　２，算术逻辑操作

　　　加减乘除，增１　减１　求补　浮点运算　　与或非　亦或，位操作　　为求反

　３，移位操作

　　　算术移位　逻辑移位

　　　循环移位（带进位，不带进位）

　４，转移

　　　１，无条件转移　ｊｍｐ

　　　２，条件转移

　　　３，调用和返回

　　　４，陷阱与陷阱指令（）

　　　　　意外事故的中断

　　　　　（隐指令）

　　　５，输入输出

　　　　　入　　端口中的内容　－ｃｐｕ的寄存器

　　　　　如　ｉｎ　ａｘ，ｎ　

### 7.3，寻址方式

　寻址方式　确定本条指令的操作数地址

　　　　　　下一条要执行指令的指令地址

　　　　　　　　　　　｜　指令寻址

　　　　　　寻址方式　｜　数据寻址

一，指令的寻址

　顺序寻址（ｐｃ＋１）－》ｐｃ　是指令的长度（按）

　跳跃寻址　　由转移指令指出（可以构成循环）

二，数据寻址

　　操作码　寻址特征　　　　形式地址A

　　形式地址　指令字中的地址

　　有效地址　操作数的真实地址

　　约定：　指令字长＝存储字长＝机器字长

　　１，立即数寻址

　　　　形式地址Ａ就是操作数

　　　　指令执行阶段不访存

　　　　Ａ的位数限制了立即数的范围

　　２，直接寻址

　　　　ＥＡ＝Ａ　有效地址由显示地址直接给出

　　　　执行阶段访问一次存储器

　　　　Ａ的位数决定了该指令操作数的寻址范围

　　　　操作数的地址不易修改

　　３，隐含寻址

　　　　操作数地址隐含在操作码中

　　　　另一个操作数隐含在ａｃｃ中

　　４，间接寻址

　　　　ＥＡ＝（Ａ）有效地址由形式地址间接提供

　　　　执行指令阶段２次访存

　　　　可扩大寻址范围

　　　　便于编制程序

　　５，寄存器寻址

　　　　ＥＡ－Ｒ　有效地址即位寄存去的编号

　　　　执行阶段不访存，只访问寄存器，执行速度快

　　　　寄存器个数有限　可缩短指令字长

　　６，寄存器间接寻址

　　　　ＥＡ　有效地址在寄存器中

　　　　有效地址在寄存器中，操作数在寄存器中，执行阶段

　　　　便于编制循环程序

　　７，基址寄存器

　　　　（１）采用专用寄存器做为基址寄存器

　　　　　　ＥＡ＝（ＢＲ）＋Ａ　ＢＲ　为基址寄存器

　　　　　可扩大寻址范围

　　　　　有利于多道程序

　　　　　ＢＲ内容由操作系统或管理程序确定

　　　　　在程序的执行过程中ＢＲ内容不变，形式地址Ａ可变

　　　　　（２）采用通用寄存器作基址寄存器

　　　　　　　　由用户指定那个通用寄存器做为基址寄存器

　　　　　　　　基址寄存器的内容由操作系统确定

　　　　　　　　在程序执行过程中ｒ。内容不变，形式地址ａ可变

　　　８，变址寻址

　　　　　ＥＡ（ｉＸ）＋ａ　ｉｘ可以采用专用

　　　　　　　　　　　　　　也可以用通用寄存器

　　　　　扩大寻址范围

　　　　　ｉｘ内容由用户给定

　　　　　在程序的执行过程中ｉｘ内容可变，形式地址ａ不变

　　　　　便于处理数组问题

​     　９，相对寻址

　　　　ＥＡ＝ｐｃ＋Ａ

　　　　Ａ指令当前的位移量

​        　   （１）相对寻址举例

　　　　（２）按字节寻址的相对寻址

　　１０，堆栈寻址

　　　　　１，堆栈的特点

　　　　　　　　　　　｜硬堆栈　　多个器

　　　　　　　　堆栈　｜软堆栈　　指定的存储空间

　　　　　２，堆栈寻址举例

　　　　　３，ｓｐ的修改与主存编址方法有关

　　　　　　　１，按字编址　　　进栈　出栈

　　　　　　　２，按字节编址　　

　　　　　　　

### 7.4，指令格式举例

一，设计指令格式时应该考虑的各种因素

　１，指令系统的兼容习性

　　　操作类型　　包括指令各处以及操作的难易程度

　　　数据类型　　确定那些数据类型可参与操作

　　　指令格式　　指令字长是否固定

　　　　　　　　　操作码位数，是否采用扩展操作码技术

　　　　　　　　　地址码位数，地址个数，寻址方式类

　　　寻址方式　　指令寻址，操作数寻址

　　　寄存器个数　寄存器的多少直接影响指令的执行时间

　２，ｉｂｍ３６０

　　　二地址　二地址，　三地址

　３，ｉｎｔｅｌ８０８６

　　　指令字长　１～６个字节

　　２，地址格式

　　　　零地址　　１字节

　　　　一地址　　５字节

​                                   3字节

　　　　二地址　　２字节

　　　　　　　　　３字节

　　　　　　　　　４字节

### 7.5，RISC技术

一，risc 的产生和发展

ｒｉｓｃ（ｒｅｄｕｃｅｄ instruction set computer）

  ｃｉｓｃ（ｃｏｍｐｌｅｘ　ｉｎｓｔｒｕｔｉｏｎ　ｓｅｔ　ｃｏｍｐｕｔｅｒ）

　２－８

典型程序中８０的语句仅仅使２０的指令

多指令结构复杂，　复杂指令

能否用２０％的简单指令组合不常用的８０指令

二，ｒｉｓｃ的主要特征

　　选用使用频度较高的依稀简单指令，复杂指令功能由简单指令来组合

　　指令长度固定，指令格式种类少，寻址方式少

　　只有ｌｏａｄ/store指令访存

　　ｃｐｕ中有多个通用寄存器

　　采用流水技术　一个时钟周期，内完成一条指令

　　采用　组合逻辑实现控制器

三，ｃｉｓｃ的主要特征

　　系统指令复杂庞大，各种指令使用频度相差大

　　指令长度不固定，指令格式种类多，寻址方式多

　　访存指令不收限制

　　ｃｐｕ中没有专用寄存器

　　大多数指令需要多个时钟周期执行完毕

　　采用微程序控制器

四，ｒｉｓｃ和ｃｉｓｃ的比较

　　１，ｒｉｓｃ更能充分利用ｖｌｓｉ芯片的面积

　　２，ｒｉｓｃ更能提高计算机运行速度指令数，指令格式，寻址方式少，通用寄存器多，采用组合逻辑，便于实现指令流水

　　３，ｒｉｓｃ便于设计。可降低成本，提高可靠性

　　４，ｒｉｓｃ不易实现指令系统兼容

## 计算机组成原理－－机器

## 第八章　ｃｐｕ的结构和和功能

###　8.1　ｃｐｕ结构

　１，控制器的功能

　　　取指令

　　　分析指令

　　　执行指令，发出各种操作命令

　　　控制程序输入及结果的输出

　　　总线管理

　　　处理异常情况和特殊请求

　２，运算器的功能

　　　实现算术运算和逻辑运算

　　　指令控制，操作控制，时间控制，处理控制，数据加工

二，ｃｐｕ结构框图

　　１，ｃｐｕ与系统总线

　　　　　指令控制　　ｐｃ　ｉｒ

　　　　　操作控制　　｜ｃｕ　时序电路

　　　　　时间控制　　｜

　　　　　数据加工　　　ａｌｕ寄存器

　　　　　处理中断　　　中断系统

　　　　控制总线，数据总线，地址总线

三，ｃｐｕ的寄存器

　　１，　用户可见寄存器

　　　　１，通用寄存器　存放操作数

　　　　　　　　　　　　可作　某种寻址方式，所需的专用寄存器

　　　　２，数据寄存器　存放操作数（满足各种数据类型，两个寄存器拼接存放双倍字长数据）

　　　　３，地址寄存器　存放地址，其位数应该满足最大的地址范围，用于特殊寻址方式，段基值，栈指针

　　　　４，条件码寄存器　存放条件码，可作程序分支的依据

　　　　　　　如　正，负，０，溢出，进位等

　　　２，控制和状态寄存器

　　　　１，控制寄存器

　　　　　　ｐｃ－ｍａｒ－ｍ－ｍｄｒ－ｉｒ

　　　　　　控制ｃｐｕ操作

　　　　　　其中ｍａｒ，ｍｄｒ，ｉｒ　ｐｃ　　用户不可见

　　　　　　　　　　　　　　　　　　　　　　　用户可见

　　　　２，状态寄存器

　　　　　　状态寄存器　　存放条件码

　　　　　　ｐｓｗ存放寄存器　存放程序状态字

四，控制单元ｃｕ和中断系统

　　１，ｃｕ　产生全部指令的微操作命令序列

　　　　组合逻辑设计　　硬件线逻辑

　　　　维程序设计　　　存储逻辑

　　２，中断系统

五，ａｌｕ

###　8.2　指令周期

一，指令周期的基本概念

　　１，指令周期

　　　　取出并执行一条指令所需的全部时间

　　　　完成一条指令　｜取指令　分析　　取指周期

　　　　　　　　　　　｜执行　　　　　　执行周期

　　２，每条指令的指令周期同

　　３，具有间接寻址的指令周期

　　４，带有中断周期的指令周期

　　５，指令周期流程

　　６，ｃｐｕ工作周期的标志

　　　　ｃｐｕ访问内存有四中性质

　　　　　取　指令　　　　取指周期　　　　

　　　　　取　地址　　　　间地周期　　　ｃｐｕ４个周期

　　　　　取存　操作数结果　执行周期

　　　　　存　程序断点　　　中断周期

二，指令周期的数据流

　　１，取地周期数据流

　　２，间址周数据流

　　３，执行周期数据流

　　４，中断周期数据流

###　8.3　指令流水

一，如何提高机器速度

　　１．提高访存速度

　　　　高速芯片　　ｃａｃｈｅ　多体并行

　　２，提高ｉ/ｏ个主机之间的传送速度

　　　　中断　　ｄｍａ　　通道　　ｉ/ｏ处理机　多总线

　　３，提高运算器速度

　　　　高速芯片　　改进算法　　　快速进位链

　　提高整理机处理能力

　　　　高速器件　改进系统结构　　开发系统的并行性

二，系统并行性

　　１，并行的概念

　　　　并行　　｜　并发　两个或连个以上事件在统一时间段发生

　　　　　　　　｜　同时　两个或两个以上事件在统一时刻发生

　　　　　　　　　　　　　　时间上互相重叠

　　２，并行性的等级

　　　　过程级（程序，进程）　粗粒度　　软实现

　　　　指令级（指令之间，指令系统　细粒度　硬件

三，指令流水原理

　　１，指令的串行执行

　　　　取指令　取指令部件　完成

　　　　执行指令　　执行指令部件　完成

　　２，指令的二级流水

　　　　若取指令和执行阶段时间上完全重叠

　　　　指令周期减半　速度提高１倍	

　　３，影响指令流水效率加倍的因素

　　　　１，执行时间>取地址时间

　　　　２，条件转移指令对指令流水的影响

　　　　　　必须等上条指令执行结束，才能确定下条指令的地址

　　　　　　造成时间损失　　　猜测法(算命)

　　　４，指令的六级流水

三，影响指令流水性能的因素

　　１，结构相关性，不同指令征用同一功能 (停顿)

　　２，数据相关　

　　　　先写后读相关

　　　　读后写相关

　　　　写后写相关

　　　　（解决方法）　后推法　采用旁路技术

　　３，控制相关

　　　　由转移指令引起

四，流水线性能

　　１，吞吐率

　　　　单位时间内流水线所完成指令或输出结果的数量

　　　　最大吞吐率

　　　　实际吞吐率

　　２，加速比

　　　　ｍ段的流水线的速度与工能的非流水线的速度至比

　　３，效率　流水线的利用率

五，流水线的多发技术

　　１，超标量技术

　　　　每个时钟周期内可并发多条独立指令

　　　　配置多个功能而部件

　　　　不能调整指令的执行顺序

　　　　通过编译优化技术，把可以并行执行的执行搭配起来

　　２，超流水线技术

　　　　在一个时钟周期内再分段

　　　　在一个一周周期内　一个功能部件使用多次

　　　　不能调整指令的执行顺序

　　　　靠编译程序解决优化问题

　　３，超长指令字技术

　　　　由编译程序挖掘出指令间潜在的并行性

　　　　将多条能并行操作的指令组合成一条

　　　　具有多个操作码字段的超长指令字

六，流水线结构

　　１，指令流水线结构

　　　　完成一条指令分６段，每段需一个时钟周期

　　若采用流水线不断流　１个时钟周期出１个结果

　　不采用流水线技术　　６个时钟周期出１个结果

　　理想条件

　２，运算流水线

　　　完成浮点加减运算　可分

　　　対阶　尾数求和，　规格化三段

　　　分段原则　每段操作时间尽量一致

###　8.4　中断系统

一，概述

　１，引起终端的各种因素

　　　１，认为设置的中断

　　　２，程序性事故

　　　３，硬件故障

　　　４，i/0设备

　　　５，外部时间　用键盘终端现行程序

二，终端系统需解决的问题

　　１，各终端源如何向ｃｐｕ提出请求

　　２，各个短源同时提出请求怎么办

　　３，ｃｐｕ什么条件，什么时间，以什么方式

　　４，如何保护现场

　　５，如何恢复现场，如何返回

　　６，处理中断的过程又出现心的终端怎么办？

　　　硬件＋软件

二，中断请求标记和中断判优逻辑

　　１，中断请求标记　ｉｎｔｒ

　　２，终端判优逻辑

　　　　１，硬件实现（排队器）

　　　　　　（１）分散在各个终端源的接口电路

　　　　　　（２）集中在ｃｐｕ中

　　　　２，软件实现（程序查询）

　　　　　　ａ，ｂ，ｃ优先级按降序排列

三，终端服务程序入口地址的寻找

　　１，硬件向量法

　　３，软件查询法

四，中断响应

　　１，响应中断的条件

　　　　允许中断触发器

　　２，响应中断的时间

　　　　指令执行周期结束时刻由ｃｐｕ发出查询信号

　　３，中断隐指令

　　　　（１），保护程序断点

　　　　（２），寻找服务程序入口地址

　　　　　　　　向量地址－》ｐｃ（硬件向量法）

　　　　　　　　中断识别程序入口地址ｍ－ｐｃ

　　　　（３）硬件关中断

　　　　　　　ｉｎｔ中断标记

　　　　　　　ｅｉｎｔ允许中断

　　　　　　　ｒ－ｓ触发器

五，保护现场和恢复现场

　　１，保护现场　｜断点　　　　中断隐指令完成

　　　　　　　　　｜寄存器内容　中断服务程序完场

　　２，恢复现场　中断服务程序完场

　　　　中断服务程序　｜保护现场

　　　　　　　　　　　｜其他服务程序

　　　　　　　　　　　｜恢复现场

　　　　　　　　　　　｜中断返回

六，多重中断

　　１，多重中断的概念。

　　　　程序断点

　　２，实现多重中断的条件

　　　　（１）允许中断触发器

　　　　（２）优先级别高的中断源有圈中断优先级别低缎带中断源

　　３，屏蔽技术

　　　　（１）屏蔽触发器的作用

　　　　（２）屏蔽字

　　　　　　　１６个中断源１，２，３－１６按照降序排列

　　　　（３）屏蔽技术可以改变处理优先等级

　　　　　　　响应有先级　不可改变

　　　　　　　处理优先级　可改变

　　　　（４）屏蔽技术的其他作用

　　　　　　　可以认为地屏蔽某个中断源的请求

　　　　（５）新屏蔽字的设置

　　　　　保护现场－》制屏蔽字－》开中断－》中断服务－》

恢复现场－》恢复屏蔽字－》开中断－》中断返回

４．多重中断的断点保护

　　（１）断电进栈　　　中断隐指令完成

　　（２）断电存入“０”地址　中断隐指令完成

　　　　　中断周期　０－》ｍａｒ

　　　　　　　　　　　　　命令存储器写

　　　　　　　　　　　　　ｐｃ－》ｍａｒ　断点－》ｍｄｒ

　　　　　　　　　　　　　（ｍｄｒ）－》存入存储器

　　　　　三次中断，三个断点

　　（３）程序断点存入“０”地址的断电保护

##　计算机组成原理至－ｃｐｕ

##　第九章　控制单元的功能

### 9.1　微操作命令分析

　完成一条指令分为４个工作周期

　　取指周期　间址周期　执行周期　中断周期



### 9.2　控制单元的功能

一，控制单元的外特性

　　１，输入信号

　　　　１，时钟

　　　　　　ｃｕ　受时钟控制

　　　　　　发一个操作命令或一组需同事执行的操作命令

　　２，指令寄存器

　　　　控制信号与操作码有关

　　３，标志

　　　　ｃｕ　受标志控制

　　４，外来信号

　　　　　如　ｉｎｔｒ　中断请求

　　　　　　　ｈｒｑ　　总线请求

　２，输出信号

　　　１，ｃｐｕ内的各种控制信号

　　　２，送至控制总线的信号

二，控制信号举例

　　１，不采用ｃｐｕ内部总线的方式

　　２，采用ｃｐｕ内部总线方式

三，多级时序系统

　　１，机器周期

　　　１，机器周期概念

　　　　　所有指令执行过程中的一个基准时间

　　　２，确定机器周期需考虑的因素

　　　　　每条指令执行步骤

　　　　　每一步骤所需的时间

　　　３，基准时间的确定

　　　　　以完成最负载指令功能的时间为准

　　　　　以访问一次存储器的时间为准

　　２，时钟周期（节拍，状态）

　　　　　一个机器周期内可以完成若干个微操作

　　　　　每个微操作需一定时间

　　　　　将一个机器周期分成若干个时间相等的时间段

　　　　　（节拍，状态，时钟周期）

　　　　　用时钟周期控制产生一个或几个微操作命令

　　　３，多级时序系统

　　　　　机器周期，节拍（状态）组成多级时序系统

　　　　　一个指令周期包含若干个机器周期

　　　　　一个机器周期包含若干个时钟周期

　　　４，机器速度与机器主频的关系

　　　　　机器的主频ｆ越快速度越快

　　　　　在机器周期所含时钟周期数相同

　　　　　两机平均指令执行速度之比，等于两机主频之比

　　　　　机器速度不仅与主频有关，还与机器周期所含时钟周期数以及指令周期中所含的机器周期有关

四，控制方式

　　产生不同微操作命令序列所用的时序控制方式

　　１，同步控制方式

　　　　任意微操作均由统一基准时标的时序信号

　　　　１，采用长的机器周期

　　　　　　以最长的微操作序列和最复杂的微操作作为标准

　　　　２，采用不定长的机器周期

　　　　　　机器周期内街拍数不等

　　　　３．采用中央控制可局部控制相结合的方法

　　　　２，异步控制方式

　　　　　　无基准时标信号

　　　　　　无固定的周期节拍和严格的时钟同步

　　　　　　采用应答方式

　　　　３，联合控制方式

　　　　　　同步与异步相结合

　　　　４，人工控制方式

　　　　　　１，ｒｅｓｅｔ

　　　　　　２，连续和单条指令执行转换开关

　　　　　　３，符合停机开关

##　第十章

###　10.1　组合逻辑设计

一，组合逻辑控制单元框图

　　１，ｃｕ外特性

　　２，节拍信号

二，微操做的节拍安排

　　采用同步控制方式

　　一个机器周期内有３个节拍（时钟周期）

　　ｃｐｕ内部结构采用非总线方式

　１，安排微操作时序的原则

　　原则一，微操作的先后顺序不得随意更改

　　原则二，被空对象不同的微操作尽量安排在一个节拍内完成

　　原则三，占用时间较短的微操作尽量安排在一个节拍内完成

　　　　　　并允许有先后顺序

　　２，取指周期	微操作的节拍安排

　　３，间址周期微操作的节拍安排

　　４，执行周期微操作的节拍安排

　　５，中断周期微操作的节拍安排

　　　　　中断隐指令完成

三，组合逻辑设计步骤

　　１，列出操作时间表

| 工作周期标记 | 节拍 | 状态节拍 | 微操作命令信号       | ｃｌａ | ｃｏｍ |
| ------------ | ---- | -------- | -------------------- | ------ | ------ |
| EF取指令     | t0   |          | ｐｃ－》ｍａｒ       |        |        |
|              | t1   |          | １－Ｒ               |        |        |
|              | t2   |          | ｍ（ｍａｒ）－ｍＤＲ |        |        |
|              |      |          |                      |        |        |
|              |      |          |                      |        |        |

三，组合逻辑设计步骤

　　１，列出操作时间表

### 10.2　微程序设计　

一，程序设计思想的产生

　　　　　　　　　｜微操作命令１　　｜微指令１　　　｜

完成一条机器指令　｜微操作命令２　　｜１０１０００ 　｜　微程序

　　　　　　　　　｜位操作命令ｎ　　｜微操作命令　　｜

一，条机器指令对应一个微程序

　　　　　　　　　存储逻辑

二，微程序控制单元框图以工作原理

　１，机器指令对应的微程序

　　　　　　　　　　　　　　取地址周期微程序

　２，微程序控制单元的基本框图

　３，工作原理

　　　１，取址阶段　执行取地址微程序

　　　２，执行阶段　执行ｌｄａ微程序

　　　３，取地址阶段　执行取地址微程序

　　关键：微指令的操作控制字段如何形成微操作命令

　　　　　微指令的后续地址如何形成

三，微指令的编码方式（控制方式）

　　１，直接编码方式

　　２，在微指令操作控制字段中

　　　　每一位代表一个微操作命令

　　２，字段直接编码方式

　　　　将微指令的控制字段分成若干份

　　　　每段经译码后发出控制信号

　　３，字段间接编码方式

　　４，混合编码

　　　　直接编码和字段编码（直接和间接）混合使用

　　５，其他

四，微指令序列地址的形成

　　１，微指令的下地址字段指出

　　２，根据机器指令操作码形成

　　３，增量计数器

　　４，分支转移

　　　　转移方式　指明判别条件

　　　　转移地址　指明转移成功后的去向

　　５，通过测试网络

　　６．由硬件产生微程序入口地址

　　　　第一条微指令地址

　　７，后续微指令地址形成方式原理图

五，微指令格式

　　１，水平型微指令

　　　　一次能定义并执行多个并行操作

　　　　如直接编码，字段直接编码，字段间接编码

　　　　　直接和字段混合编码

　　２，垂直型微指令

　　　　类似机器指令操作码的方式

　　　　由微操作字段码规定微指令的功能

　　３，两种微指令格式比较

　　　　１，水平型微指比垂直型微指令　并行操作能力强

　　　　　　灵活性强

　　　　２，水平型微指令执行一条机器指令索要的微指令　数目少，速度块

　　　　３，水平性微指令，用较短的微程序结构换取较长的微指令结构

六，静态微程序设计动态微程序设计

　　静态　微指令无需改变　采用ｒｏｍ

　　动态　通过改变微指令和微程序改变机器指令有利于仿真，采用ｅｐｒｏｍ

七，毫微程序设计

　　１，毫微程序设计的基本概念

　　　　微程序设计　　用微程序解释机指令

　　　　毫微程序设计　用毫微程解释微指令

　　　　毫微指令与微指令的关系好比微指令与机器指令

　　２，毫微程序控制存储器的基本组成

　　　　

八，串行微程序控制和并行微程序控制

　　串行微程序控制

　　并行微程序控制

九，微程序设计举例

　　１，写出对应机器指令的微操作及节拍安排

　　　　（１）取指令阶段微操作分析　

　　　　（２）取值阶段的微操作及节拍安排

　　　　（３）执行阶段的微操作及节拍安排

## cpu 678





## cu 9-10

